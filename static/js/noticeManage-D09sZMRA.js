import{y as e,r as t,c as l,z as a,R as o,J as i,I as s,L as n,u as p,al as u,B as d,P as r,O as c,E as f,Q as h,a6 as m,aD as w,A as b}from"./vue-BMnUnhjY.js";import{u as _,s as v}from"./index-BT6KgQx3.js";import{e as T,w as y,S as g,a3 as S,a4 as V,E as k,C as U}from"./elementPlus-iRxZk2_b.js";import{_ as C}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as O}from"./tablePage-YHXugbiE.js";import{N as A}from"./statusConfig-Cju3zQbK.js";import{u as D}from"./useDictionary-Cg9QFWfd.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";const R={class:"notice-manage-container common-action-column"},x=["title","onClick"],j={class:"action-buttons"},L=["onClick"],N=["onClick"],B=["onClick"],P=I(e({__name:"noticeManage",setup(e){const I=w(),P=_().isAdmin,$={title:"",noticeType:"",publishStatus:"",importance:"",isTop:"",publishTimesRange:[],updatedTimesRange:[],publishDateRange:[]},{dictList:Y,getDictLabel:q}=D({dictType:"notice_type",autoLoad:!0}),{dictList:z,getDictLabel:F}=D({dictType:"notice_importance",autoLoad:!0}),M=t(null),E=t([]),H=l(()=>0===E.value.length||E.value.some(e=>"1"===e.publishStatus)),J=e=>v.post("/api/notice/list",e),K=e=>{E.value=e},Q=()=>{I.push({path:"/modifyNotice",query:{mode:"add",tabTitle:encodeURIComponent("新增通知")}})},W=e=>{const t=!e;if(t&&0===E.value.length)return void k.warning("请选择要删除的通知");if(t&&E.value.some(e=>"1"===e.publishStatus))return void k.warning("已发布的通知不能删除");if(!t&&"1"===e?.publishStatus)return void k.warning("已发布的通知不能删除");const l=t?E.value.map(e=>e.id):e.id,a=t?`确认删除选中的 ${E.value.length} 条通知吗？`:"确认删除该通知吗？";U.confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v.post("/api/notice/delete",{ids:l}).then(()=>{k.success("删除成功"),G(1)})}).catch(()=>{})},G=e=>{M.value&&M.value.getList(e)};return(e,t)=>{const l=u("el-input"),w=u("el-form-item"),_=u("el-col"),D=u("el-option"),E=u("el-select"),X=u("el-date-picker"),Z=u("el-icon"),ee=u("el-tooltip"),te=u("el-table-column"),le=u("el-tag");return b(),a("div",R,[o(O,{ref_key:"tablePageRef",ref:M,fetchData:J,initialSearchForm:$,onSelectionChange:K},{"search-form":i(({form:e})=>[o(_,{span:6},{default:i(()=>[o(w,{label:"通知标题"},{default:i(()=>[o(l,{modelValue:e.title,"onUpdate:modelValue":t=>e.title=t,placeholder:"请输入通知标题",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(w,{label:"通知类型"},{default:i(()=>[o(E,{modelValue:e.noticeType,"onUpdate:modelValue":t=>e.noticeType=t,placeholder:"请选择通知类型",clearable:""},{default:i(()=>[(b(!0),a(h,null,m(p(Y),e=>(b(),s(D,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),p(P)?(b(),s(_,{key:0,span:6},{default:i(()=>[o(w,{label:"状态"},{default:i(()=>[o(E,{modelValue:e.publishStatus,"onUpdate:modelValue":t=>e.publishStatus=t,placeholder:"请选择状态",clearable:""},{default:i(()=>[(b(!0),a(h,null,m(p(A).list,e=>(b(),s(D,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):n("",!0),o(_,{span:6},{default:i(()=>[o(w,{label:"重要程度"},{default:i(()=>[o(E,{modelValue:e.importance,"onUpdate:modelValue":t=>e.importance=t,placeholder:"请选择重要程度",clearable:""},{default:i(()=>[(b(!0),a(h,null,m(p(z),e=>(b(),s(D,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(w,{label:"是否置顶"},{default:i(()=>[o(E,{modelValue:e.isTop,"onUpdate:modelValue":t=>e.isTop=t,placeholder:"请选择是否置顶",clearable:""},{default:i(()=>[o(D,{label:"否",value:0}),o(D,{label:"是",value:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(w,{label:"通知发布日期"},{default:i(()=>[o(X,{modelValue:e.publishDateRange,"onUpdate:modelValue":t=>e.publishDateRange=t,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),n("",!0),n("",!0)]),operation:i(()=>[p(P)?(b(),a(h,{key:0},[o(ee,{content:"新增通知",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[o(C,{size:"small",type:"primary",onClick:Q},{default:i(()=>[o(Z,null,{default:i(()=>[o(p(V))]),_:1})]),_:1})]),_:1}),o(ee,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[o(C,{size:"small",type:"danger",disabled:H.value,onClick:t[0]||(t[0]=e=>W())},{default:i(()=>[o(Z,null,{default:i(()=>[o(p(S))]),_:1})]),_:1},8,["disabled"])]),_:1})],64)):n("",!0)]),default:i(()=>[p(P)?(b(),s(te,{key:0,type:"selection",width:"50",fixed:"left"})):n("",!0),o(te,{prop:"title",label:"通知标题",minWidth:"200",showOverflowTooltip:""},{default:i(e=>[d("span",{class:"clickable-title",title:e.row.title,onClick:t=>(e=>{const t=`通知详情【${e.title}】`;I.push({path:"/noticeDetail",query:{mode:"view",id:String(e.id),tabTitle:encodeURIComponent(t)}})})(e.row)},r(e.row.title),9,x)]),_:1}),o(te,{prop:"noticeType",label:"通知类型",width:"120",showOverflowTooltip:""},{default:i(e=>[c(r(p(q)(e.row.noticeType.toString())),1)]),_:1}),o(te,{prop:"publishStatus",label:"状态",width:"100",showOverflowTooltip:""},{default:i(e=>[o(le,{type:p(A).getTagType(e.row.publishStatus)},{default:i(()=>[c(r(p(A).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(te,{prop:"importance",label:"重要程度",width:"100",showOverflowTooltip:""},{default:i(e=>[o(le,{type:"3003"===e.row.importance?"danger":"3002"===e.row.importance?"warning":"info",effect:"3003"===e.row.importance?"dark":"light"},{default:i(()=>[c(r(p(F)(e.row.importance.toString())),1)]),_:2},1032,["type","effect"])]),_:1}),o(te,{prop:"isTop",label:"是否置顶",width:"100",showOverflowTooltip:""},{default:i(e=>[o(le,{type:1===e.row.isTop?"success":"info",effect:1===e.row.isTop?"dark":"plain"},{default:i(()=>[c(r(1===e.row.isTop?"是":"否"),1)]),_:2},1032,["type","effect"])]),_:1}),o(te,{prop:"publishDate",label:"通知发布日期",width:"120",showOverflowTooltip:""}),o(te,{prop:"publishUserName",label:"发布人",width:"120",showOverflowTooltip:""}),o(te,{prop:"publishTimes",label:"发布时间",width:"180",showOverflowTooltip:""}),o(te,{prop:"updateUserName",label:"更新人",width:"120",showOverflowTooltip:""}),o(te,{prop:"updatedTimes",label:"更新时间",width:"180",showOverflowTooltip:""}),o(te,{prop:"createUserName",label:"创建人",width:"120",showOverflowTooltip:""}),o(te,{prop:"createdTimes",label:"创建时间",width:"180",showOverflowTooltip:""}),p(P)?(b(),s(te,{key:1,label:"操作",width:"110",fixed:"right"},{default:i(e=>[d("div",j,[o(ee,{content:"1"===e.row.publishStatus?"已发布通知不可编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[d("span",{class:f(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:t=>"1"!==e.row.publishStatus&&(e=>{const t=`编辑通知【${e.title}】`;I.push({path:"/modifyNotice",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(t)}})})(e.row)},[o(Z,{class:"action-icon edit-icon"},{default:i(()=>[o(p(T))]),_:1})],10,L)]),_:2},1032,["content"]),o(ee,{content:"1"===e.row.publishStatus?"下线":"发布",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[d("span",{class:"action-icon-wrapper",onClick:t=>((e,t)=>{const l="publish"===t,a=l?"发布":"下线";U.confirm(`确认${a}该通知吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:l?"info":"warning"}).then(()=>{v.post("/api/notice/publish",{id:e.id,action:t}).then(()=>{k.success(`${a}成功`),G(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(Z,{class:f(["action-icon","1"===e.row.publishStatus?"unpublish-icon":"publish-icon"])},{default:i(()=>["1"===e.row.publishStatus?(b(),s(p(y),{key:0})):(b(),s(p(g),{key:1}))]),_:2},1032,["class"])],8,N)]),_:2},1032,["content"]),o(ee,{content:"1"===e.row.publishStatus?"已发布通知不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[d("span",{class:f(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:t=>"1"!==e.row.publishStatus&&W(e.row)},[o(Z,{class:"action-icon delete-icon"},{default:i(()=>[o(p(S))]),_:1})],10,B)]),_:2},1032,["content"])])]),_:1})):n("",!0)]),_:1},512)])}}}),[["__scopeId","data-v-231728d4"]]);export{P as default};
