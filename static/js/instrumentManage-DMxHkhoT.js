import{y as e,r as t,c as l,z as a,R as o,J as s,I as n,L as i,u,al as r,B as p,P as d,O as c,E as m,Q as h,a6 as f,aD as b,A as w}from"./vue-BMnUnhjY.js";import{u as _,s as v}from"./index-BT6KgQx3.js";import{e as g,w as T,S as y,a3 as S,a4 as V,E as U,C as k}from"./elementPlus-iRxZk2_b.js";import{_ as C}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as I}from"./tablePage-YHXugbiE.js";import{c as A}from"./statusConfig-Cju3zQbK.js";import{_ as N}from"./_plugin-vue_export-helper-BCo6x5W8.js";const O={class:"instrument-manage-container common-action-column"},x=["title","onClick"],R={class:"action-buttons"},j=["onClick"],B=["onClick"],P=["onClick"],D=N(e({__name:"instrumentManage",setup(e){const N=A("待发布","已发布","已下线"),D=b(),$=_().isAdmin,Y={instName:"",manufacturer:"",model:"",publishStatus:"",createUserId:"",publishTimesRange:[]},q=t(null),z=t([]),F=l(()=>0===z.value.length||z.value.some(e=>"1"===e.publishStatus)),M=e=>v.post("/api/instrument/list",e),E=e=>{z.value=e},L=()=>{D.push({path:"/modifyInstrumentInfos",query:{mode:"add",tabTitle:encodeURIComponent("新增仪器")}})},J=e=>{const t=!e;if(t&&0===z.value.length)return void U.warning("请选择要删除的仪器");if(t&&z.value.some(e=>"1"===e.publishStatus))return void U.warning("已发布的仪器不能删除");if(!t&&"1"===e?.publishStatus)return void U.warning("已发布的仪器不能删除");const l=t?z.value.map(e=>e.id):e.id,a=t?`确认删除选中的 ${z.value.length} 条仪器信息吗？`:"确认删除该仪器信息吗？";k.confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v.post("/api/instrument/delete",{ids:l}).then(()=>{U.success("删除成功"),K(1)})}).catch(()=>{})},K=e=>{q.value&&q.value.getList(e)};return(e,t)=>{const l=r("el-input"),b=r("el-form-item"),_=r("el-col"),A=r("el-option"),z=r("el-select"),Q=r("el-date-picker"),W=r("el-icon"),G=r("el-tooltip"),H=r("el-table-column"),X=r("el-tag");return w(),a("div",O,[o(I,{ref_key:"tablePageRef",ref:q,fetchData:M,initialSearchForm:Y,onSelectionChange:E},{"search-form":s(({form:e})=>[o(_,{span:6},{default:s(()=>[o(b,{label:"仪器名称"},{default:s(()=>[o(l,{modelValue:e.instName,"onUpdate:modelValue":t=>e.instName=t,placeholder:"请输入仪器名称",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"生产厂家"},{default:s(()=>[o(l,{modelValue:e.manufacturer,"onUpdate:modelValue":t=>e.manufacturer=t,placeholder:"请输入生产厂家",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"型号"},{default:s(()=>[o(l,{modelValue:e.model,"onUpdate:modelValue":t=>e.model=t,placeholder:"请输入型号",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),u($)?(w(),n(_,{key:0,span:6},{default:s(()=>[o(b,{label:"发布状态"},{default:s(()=>[o(z,{modelValue:e.publishStatus,"onUpdate:modelValue":t=>e.publishStatus=t,placeholder:"请选择发布状态",clearable:""},{default:s(()=>[(w(!0),a(h,null,f(u(N).list,e=>(w(),n(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):i("",!0),o(_,{span:6},{default:s(()=>[o(b,{label:"创建人"},{default:s(()=>[o(l,{modelValue:e.createUserId,"onUpdate:modelValue":t=>e.createUserId=t,placeholder:"请输入创建人",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"发布时间"},{default:s(()=>[o(Q,{modelValue:e.publishTimesRange,"onUpdate:modelValue":t=>e.publishTimesRange=t,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),operation:s(()=>[u($)?(w(),a(h,{key:0},[o(G,{content:"新增仪器",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(C,{size:"small",type:"primary",onClick:L},{default:s(()=>[o(W,null,{default:s(()=>[o(u(V))]),_:1})]),_:1})]),_:1}),o(G,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(C,{size:"small",type:"danger",disabled:F.value,onClick:t[0]||(t[0]=e=>J())},{default:s(()=>[o(W,null,{default:s(()=>[o(u(S))]),_:1})]),_:1},8,["disabled"])]),_:1})],64)):i("",!0)]),default:s(()=>[u($)?(w(),n(H,{key:0,type:"selection",width:"50",fixed:"left"})):i("",!0),o(H,{prop:"instName",label:"仪器名称",minWidth:"180",showOverflowTooltip:""},{default:s(e=>[p("span",{class:"clickable-title",title:e.row.instName,onClick:t=>(e=>{const t=`仪器详情【${e.instName}】`;D.push({path:"/instrumentDetail",query:{mode:"view",id:String(e.id),tabTitle:encodeURIComponent(t)}})})(e.row)},d(e.row.instName),9,x)]),_:1}),o(H,{prop:"manufacturer",label:"生产厂家",width:"160",showOverflowTooltip:""}),o(H,{prop:"model",label:"型号",width:"120",showOverflowTooltip:""}),o(H,{prop:"publishStatus",label:"发布状态",width:"100",showOverflowTooltip:""},{default:s(e=>[o(X,{type:u(N).getTagType(e.row.publishStatus)},{default:s(()=>[c(d(u(N).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(H,{prop:"publishUserName",label:"发布人",width:"120",showOverflowTooltip:""}),o(H,{prop:"publishTimes",label:"发布时间",width:"180",showOverflowTooltip:""}),o(H,{prop:"updateUserName",label:"更新人",width:"120",showOverflowTooltip:""}),o(H,{prop:"updatedTimes",label:"更新时间",width:"180",showOverflowTooltip:""}),o(H,{prop:"createUserName",label:"创建人",width:"120",showOverflowTooltip:""}),o(H,{prop:"createdTimes",label:"创建时间",width:"180",showOverflowTooltip:""}),u($)?(w(),n(H,{key:1,label:"操作",width:"110",fixed:"right"},{default:s(e=>[p("div",R,[o(G,{content:"1"===e.row.publishStatus?"已发布仪器不可编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[p("span",{class:m(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:t=>"1"!==e.row.publishStatus&&(e=>{const t=`编辑仪器【${e.instName}】`;D.push({path:"/modifyInstrumentInfos",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(t)}})})(e.row)},[o(W,{class:"action-icon edit-icon"},{default:s(()=>[o(u(g))]),_:1})],10,j)]),_:2},1032,["content"]),o(G,{content:"1"===e.row.publishStatus?"下线":"发布",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[p("span",{class:"action-icon-wrapper",onClick:t=>((e,t)=>{const l="publish"===t,a=l?"发布":"下线";k.confirm(`确认${a}该仪器吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:l?"info":"warning"}).then(()=>{v.post("/api/instrument/publish",{id:e.id,action:t}).then(()=>{U.success(`${a}成功`),K(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(W,{class:m(["action-icon","1"===e.row.publishStatus?"unpublish-icon":"publish-icon"])},{default:s(()=>["1"===e.row.publishStatus?(w(),n(u(T),{key:0})):(w(),n(u(y),{key:1}))]),_:2},1032,["class"])],8,B)]),_:2},1032,["content"]),o(G,{content:"1"===e.row.publishStatus?"已发布仪器不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[p("span",{class:m(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:t=>"1"!==e.row.publishStatus&&J(e.row)},[o(W,{class:"action-icon delete-icon"},{default:s(()=>[o(u(S))]),_:1})],10,P)]),_:2},1032,["content"])])]),_:1})):i("",!0)]),_:1},512)])}}}),[["__scopeId","data-v-16db713a"]]);export{D as default};
