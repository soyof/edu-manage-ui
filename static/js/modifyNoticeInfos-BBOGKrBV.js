import{y as e,r as l,ay as t,c as a,l as o,h as i,z as n,B as r,P as d,R as u,J as s,al as p,u as c,I as m,Q as f,a6 as h,O as g,aD as y,A as b}from"./vue-BMnUnhjY.js";import{S as V,E as _}from"./elementPlus-iRxZk2_b.js";import{T as v}from"./tinyMceEditor-EOAlt4H2.js";import{a as T,p as E,s as U}from"./index-BT6KgQx3.js";import{u as k}from"./useDictionary-Cg9QFWfd.js";import{u as D}from"./useLoading-D-rekEU2.js";import{_ as q}from"./_plugin-vue_export-helper-BCo6x5W8.js";const L={class:"modify-notice-container"},w={class:"card-header"},I={class:"header-buttons"},j={class:"custom-card box-card"},R={class:"card-body"},x=q(e({__name:"modifyNoticeInfos",setup(e){const q=T(E),{changeLoading:x,closeLoading:M}=D(),S=t(),Y=y(),C=l(S.query.mode||"add"),P=l(S.query.id),A=a(()=>{if(S.query.title)return S.query.title;switch(C.value){case"add":return"新增通知";case"edit":return"编辑通知";default:return"通知信息"}}),{dictList:F}=k({dictType:"notice_type",autoLoad:!0}),{dictList:N}=k({dictType:"notice_importance",autoLoad:!0}),O=l(),z=o({id:"",title:"",titleEn:"",noticeType:"2002",importance:"3001",content:"",contentEn:"",linkUrl:"",status:0,isTop:0,publishDate:(new Date).toISOString().split("T")[0]}),B={title:[{required:!0,message:"请输入中文通知标题",trigger:"blur"}],titleEn:[{required:!1,message:"请输入英文通知标题",trigger:"blur"}],noticeType:[{required:!0,message:"请选择通知类型",trigger:"change"}],importance:[{required:!0,message:"请选择重要程度",trigger:"change"}],linkUrl:[{required:!0,message:"请输入链接地址",trigger:"blur"},{validator:(e,l,t)=>{if(l&&""!==l)try{const e=new URL(l);"http:"===e.protocol||"https:"===e.protocol?t():t(new Error("请输入http或https开头的有效网址"))}catch{try{new URL("http://"+l),t()}catch{t(new Error("请输入有效的网址格式"))}}else t()},trigger:"blur"}],content:[{validator:(e,l,t)=>{"2002"!==String(z.noticeType)||l?t():t(new Error("请输入中文通知内容"))},trigger:"blur"}],contentEn:[{required:!1,message:"请输入英文通知内容",trigger:"blur"}]},H=a(()=>"2002"===z.noticeType),J=()=>{},Q=()=>{O.value&&O.value.validate(e=>{if(!e)return;const l={id:z.id,title:z.title,titleEn:z.titleEn,noticeType:z.noticeType,importance:z.importance,isTop:z.isTop,publishDate:z.publishDate,content:z.content||"",contentEn:z.contentEn||"",linkUrl:z.linkUrl||""};x(!0),U.post("/api/notice/save",l).then(e=>{e&&_.success((z.id?"更新":"添加")+"通知成功")}).finally(()=>{M(),q.delCurTab(S.fullPath,Y,"/noticeManage")})})};return i(()=>{"edit"===C.value&&P.value&&(x(!0),U.post("/api/notice/detail",{id:P.value}).then(e=>{if(e){const l=e;z.id=l.id,z.title=l.title,z.titleEn=l.titleEn,z.noticeType=l.noticeType,z.importance=l.importance,z.isTop=l.isTop||0,z.publishDate=l.publishDate||null,z.content=l.content||"",z.contentEn=l.contentEn||"",z.linkUrl=l.linkUrl||"",z.status=l.status}}).finally(()=>{M()}))}),(e,l)=>{const t=p("el-icon"),a=p("el-button"),o=p("el-tooltip"),i=p("el-input"),y=p("el-form-item"),_=p("el-option"),T=p("el-select"),E=p("el-radio"),U=p("el-radio-group"),k=p("el-date-picker"),D=p("el-form");return b(),n("div",L,[r("div",w,[r("h2",null,d(A.value),1),r("div",I,[u(o,{content:"保存",placement:"top",showAfter:300},{default:s(()=>[u(a,{type:"primary",circle:"",loading:!1,onClick:Q},{default:s(()=>[u(t,null,{default:s(()=>[u(c(V))]),_:1})]),_:1})]),_:1})])]),r("div",j,[r("div",R,[u(D,{ref_key:"formRef",ref:O,model:z,rules:B,labelWidth:120},{default:s(()=>[u(y,{label:"通知标题(中)",prop:"title"},{default:s(()=>[u(i,{modelValue:z.title,"onUpdate:modelValue":l[0]||(l[0]=e=>z.title=e),placeholder:"请输入中文通知标题"},null,8,["modelValue"])]),_:1}),u(y,{label:"通知标题(英)",prop:"titleEn"},{default:s(()=>[u(i,{modelValue:z.titleEn,"onUpdate:modelValue":l[1]||(l[1]=e=>z.titleEn=e),placeholder:"请输入英文通知标题"},null,8,["modelValue"])]),_:1}),u(y,{label:"通知类型",prop:"noticeType"},{default:s(()=>[u(T,{modelValue:z.noticeType,"onUpdate:modelValue":l[2]||(l[2]=e=>z.noticeType=e),placeholder:"请选择通知类型",onChange:J},{default:s(()=>[(b(!0),n(f,null,h(c(F),e=>(b(),m(_,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(y,{label:"重要程度",prop:"importance"},{default:s(()=>[u(T,{modelValue:z.importance,"onUpdate:modelValue":l[3]||(l[3]=e=>z.importance=e),placeholder:"请选择重要程度"},{default:s(()=>[(b(!0),n(f,null,h(c(N),e=>(b(),m(_,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(y,{label:"是否置顶",prop:"isTop"},{default:s(()=>[u(U,{modelValue:z.isTop,"onUpdate:modelValue":l[4]||(l[4]=e=>z.isTop=e)},{default:s(()=>[u(E,{label:0},{default:s(()=>[...l[9]||(l[9]=[g("否",-1)])]),_:1}),u(E,{label:1},{default:s(()=>[...l[10]||(l[10]=[g("是",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(y,{label:"通知发布日期",prop:"publishDate"},{default:s(()=>[u(k,{modelValue:z.publishDate,"onUpdate:modelValue":l[5]||(l[5]=e=>z.publishDate=e),type:"date",placeholder:"请选择通知发布日期",valueFormat:"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),H.value?(b(),n(f,{key:0},[u(y,{label:"通知内容(中)",prop:"content",required:""},{default:s(()=>[u(v,{modelValue:z.content,"onUpdate:modelValue":l[6]||(l[6]=e=>z.content=e),height:350,placeholder:"请输入中文通知内容"},null,8,["modelValue"])]),_:1}),u(y,{label:"通知内容(英)",prop:"contentEn"},{default:s(()=>[u(v,{modelValue:z.contentEn,"onUpdate:modelValue":l[7]||(l[7]=e=>z.contentEn=e),height:350,placeholder:"请输入英文通知内容"},null,8,["modelValue"])]),_:1})],64)):(b(),m(y,{key:1,label:"链接地址",prop:"linkUrl",required:""},{default:s(()=>[u(i,{modelValue:z.linkUrl,"onUpdate:modelValue":l[8]||(l[8]=e=>z.linkUrl=e),placeholder:"请输入超链接地址"},null,8,["modelValue"]),l[11]||(l[11]=r("div",{class:"form-tip"},"链接地址需要以http://或https://开头的完整URL",-1))]),_:1}))]),_:1},8,["model"])])])])}}}),[["__scopeId","data-v-e6e494df"]]);export{x as default};
