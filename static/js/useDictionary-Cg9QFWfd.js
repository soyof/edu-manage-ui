import{c as t,s as e}from"./index-BT6KgQx3.js";import{l as i,c as a,X as c}from"./vue-BMnUnhjY.js";const n=i({}),s=i({}),o=i({}),r=i=>{const{dictType:r,autoLoad:d=!0,customLoader:l}=i,u=t();n[r]||(n[r]=[]),s[r]||(s[r]={}),void 0===o[r]&&(o[r]=!1);const p=a(()=>{let t=[];return t=g(r)?u.getDictList(r).value:n[r]||[],t}),y=a(()=>{let t={};return t=g(r)?u.getDictObj(r).value:s[r]||{},t}),f=a(()=>o[r]),g=t=>["user_title","notice_type","notice_importance","publish_status","intro_type","dynamic_type","paper_submission_status"].includes(t),D=async(t=!1)=>{if(o[r])return;const i=g(r)?u.getDictList(r).value:n[r];if(!(!t&&i&&i.length>0)){o[r]=!0;try{if(g(r))await u.getDictByType(r,t);else if(l){const t=await l();m(r,t)}else{const t=await e.get(`/api/getDictByType?dictType=${r}`);t&&Array.isArray(t)&&m(r,t)}}catch(a){}finally{o[r]=!1}}},m=(t,e)=>{n[t]=e;const i={};e.forEach(t=>{"object"==typeof t&&null!==t&&t.dictId&&t.dictValue&&(i[t.dictId]=t.dictValue)}),s[t]=i},w=()=>{g(r)?u.clearDictCache(r):(n[r]&&(n[r]=[]),s[r]&&(s[r]={}))},h=t=>{const{dictType:e}=t.detail;e!==r&&"all"!==e||w()};"undefined"!=typeof window&&window.addEventListener("dict-cache-cleared",h),c(()=>{"undefined"!=typeof window&&window.removeEventListener("dict-cache-cleared",h)}),d&&D();return{dictList:p,dictMapping:y,loading:f,loadDictData:D,getDictLabel:(t,e=t)=>{if(!t)return e;let i;return i=g(r)?u.getDictNameByCode(r,t)||e:y.value[t]||e,i},refreshDict:()=>{w(),D(!0)},clearCache:w,isDictEmpty:()=>{const t=g(r)?u.getDictList(r).value:n[r];return!t||0===t.length}}},d=(t,e=!0)=>r({dictType:t,autoLoad:e});export{d as a,r as u};
