import{y as e,r as a,c as l,z as t,R as o,J as s,al as i,B as u,P as n,u as p,O as r,I as d,L as c,E as m,Q as h,a6 as f,aD as b,A as w}from"./vue-BMnUnhjY.js";import{u as _,s as v}from"./index-BT6KgQx3.js";import{e as g,w as T,S,a3 as V,a4 as y,E as U,C as k}from"./elementPlus-iRxZk2_b.js";import{_ as C}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as O}from"./tablePage-YHXugbiE.js";import{a as I}from"./statusConfig-Cju3zQbK.js";import{a as j}from"./useDictionary-Cg9QFWfd.js";import{_ as A}from"./_plugin-vue_export-helper-BCo6x5W8.js";const P={class:"paper-manage-container common-action-column"},R=["title","onClick"],x={key:1},D={class:"action-buttons"},Y=["onClick"],B=["onClick"],M=["onClick"],N=A(e({__name:"paperManage",setup(e){const A=b(),N=_(),$=N.isAdmin,{dictList:F,dictMapping:q}=j("paper_submission_status"),z={title:"",titleEn:"",authors:"",journal:"",publishStatus:"",submissionStatus:"",paperPublishTimesRange:[],publishTimesRange:[],updatedTimesRange:[]},E=a(null),L=a([]),H=l(()=>0===L.value.length||L.value.some(e=>"1"===e.publishStatus)),J=e=>v.post("/api/paper/list",e),K=e=>{L.value=e},Q=()=>{A.push({path:"/modifyPaperInfos",query:{mode:"add",tabTitle:encodeURIComponent("新增论文")}})},W=e=>{const a=!e,l=N.getUserInfo.value;if(a&&0===L.value.length)return void U.warning("请选择要删除的论文");if(a&&L.value.some(e=>"1"===e.publishStatus))return void U.warning("已发布的论文不能删除");if(!a&&"1"===e?.publishStatus)return void U.warning("已发布的论文不能删除");if(!$.value)if(a){if(L.value.some(e=>e.createUserName!==l?.username))return void U.warning("您只能删除自己创建的论文")}else if(e&&e.createUserName!==l?.username)return void U.warning("您只能删除自己创建的论文");const t=a?L.value.map(e=>e.id):e.id,o=a?`确认删除选中的 ${L.value.length} 条论文信息吗？`:"确认删除该论文信息吗？";k.confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v.post("/api/paper/delete",{ids:t}).then(()=>{U.success("删除成功"),G(1)})}).catch(()=>{})},G=e=>{E.value&&E.value.getList(e)};return(e,a)=>{const l=i("el-input"),b=i("el-form-item"),_=i("el-col"),j=i("el-option"),N=i("el-select"),L=i("el-date-picker"),X=i("el-icon"),Z=i("el-tooltip"),ee=i("el-table-column"),ae=i("el-tag");return w(),t("div",P,[o(O,{ref_key:"tablePageRef",ref:E,fetchData:J,initialSearchForm:z,onSelectionChange:K},{"search-form":s(({form:e})=>[o(_,{span:6},{default:s(()=>[o(b,{label:"论文标题"},{default:s(()=>[o(l,{modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,placeholder:"请输入论文标题",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"作者"},{default:s(()=>[o(l,{modelValue:e.authors,"onUpdate:modelValue":a=>e.authors=a,placeholder:"请输入作者",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"期刊名称"},{default:s(()=>[o(l,{modelValue:e.journal,"onUpdate:modelValue":a=>e.journal=a,placeholder:"请输入期刊名称",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"发布状态"},{default:s(()=>[o(N,{modelValue:e.publishStatus,"onUpdate:modelValue":a=>e.publishStatus=a,placeholder:"请选择发布状态",clearable:""},{default:s(()=>[(w(!0),t(h,null,f(p(I).list,e=>(w(),d(j,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"投稿状态"},{default:s(()=>[o(N,{modelValue:e.submissionStatus,"onUpdate:modelValue":a=>e.submissionStatus=a,placeholder:"请选择投稿状态",clearable:""},{default:s(()=>[(w(!0),t(h,null,f(p(F),e=>(w(),d(j,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),c("",!0),o(_,{span:6},{default:s(()=>[o(b,{label:"发布时间"},{default:s(()=>[o(L,{modelValue:e.publishTimesRange,"onUpdate:modelValue":a=>e.publishTimesRange=a,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"更新时间"},{default:s(()=>[o(L,{modelValue:e.updatedTimesRange,"onUpdate:modelValue":a=>e.updatedTimesRange=a,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),operation:s(()=>[o(Z,{content:"新增论文",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(C,{size:"small",type:"primary",onClick:Q},{default:s(()=>[o(X,null,{default:s(()=>[o(p(y))]),_:1})]),_:1})]),_:1}),o(Z,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(C,{size:"small",type:"danger",disabled:H.value,onClick:a[0]||(a[0]=e=>W())},{default:s(()=>[o(X,null,{default:s(()=>[o(p(V))]),_:1})]),_:1},8,["disabled"])]),_:1})]),default:s(()=>[o(ee,{type:"selection",width:"50",fixed:"left"}),o(ee,{prop:"title",label:"论文标题",minWidth:"200",showOverflowTooltip:""},{default:s(e=>[u("span",{class:"clickable-title",title:e.row.title,onClick:a=>(e=>{const a=`论文详情【${e.title}】`;A.push({path:"/paperDetail",query:{mode:"view",id:String(e.id),tabTitle:encodeURIComponent(a)}})})(e.row)},n(e.row.title),9,R)]),_:1}),o(ee,{prop:"authors",label:"作者",width:"150",showOverflowTooltip:""}),o(ee,{prop:"journal",label:"期刊名称",width:"150",showOverflowTooltip:""}),o(ee,{prop:"publishStatus",label:"发布状态",width:"100",showOverflowTooltip:""},{default:s(e=>[o(ae,{type:p(I).getTagType(e.row.publishStatus)},{default:s(()=>[r(n(p(I).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(ee,{prop:"submissionStatus",label:"投稿状态",width:"120",showOverflowTooltip:""},{default:s(e=>[e.row.submissionStatus?(w(),d(ae,{key:0,type:"info"},{default:s(()=>{return[r(n((a=e.row.submissionStatus,q.value[a]||a)),1)];var a}),_:2},1024)):(w(),t("span",x,"-"))]),_:1}),o(ee,{prop:"paperPublishTimes",label:"文献发布时间",width:"120",showOverflowTooltip:""}),o(ee,{prop:"publishUserName",label:"发布人",width:"120",showOverflowTooltip:""}),o(ee,{prop:"publishTimes",label:"发布时间",width:"180",showOverflowTooltip:""}),o(ee,{prop:"updateUserName",label:"更新人",width:"120",showOverflowTooltip:""}),o(ee,{prop:"updatedTimes",label:"更新时间",width:"180",showOverflowTooltip:""}),o(ee,{prop:"createUserName",label:"创建人",width:"120",showOverflowTooltip:""}),o(ee,{prop:"createdTimes",label:"创建时间",width:"180",showOverflowTooltip:""}),o(ee,{label:"操作",width:"110",fixed:"right"},{default:s(e=>[u("div",D,[p($)?(w(),d(Z,{key:0,content:"1"===e.row.publishStatus?"已发布论文不可编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[u("span",{class:m(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:a=>"1"!==e.row.publishStatus&&(e=>{const a=`编辑论文【${e.title}】`;A.push({path:"/modifyPaperInfos",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(a)}})})(e.row)},[o(X,{class:"action-icon edit-icon"},{default:s(()=>[o(p(g))]),_:1})],10,Y)]),_:2},1032,["content"])):c("",!0),p($)?(w(),d(Z,{key:1,content:"1"===e.row.publishStatus?"下线":"发布",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[u("span",{class:"action-icon-wrapper",onClick:a=>((e,a)=>{const l="publish"===a,t=l?"发布":"下线";k.confirm(`确认${t}该论文吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:l?"info":"warning"}).then(()=>{v.post("/api/paper/publish",{id:e.id,action:a}).then(()=>{U.success(`${t}成功`),G(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(X,{class:m(["action-icon","1"===e.row.publishStatus?"unpublish-icon":"publish-icon"])},{default:s(()=>["1"===e.row.publishStatus?(w(),d(p(T),{key:0})):(w(),d(p(S),{key:1}))]),_:2},1032,["class"])],8,B)]),_:2},1032,["content"])):c("",!0),o(Z,{content:"1"===e.row.publishStatus?"已发布论文不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[u("span",{class:m(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:a=>"1"!==e.row.publishStatus&&W(e.row)},[o(X,{class:"action-icon delete-icon"},{default:s(()=>[o(p(V))]),_:1})],10,M)]),_:2},1032,["content"])])]),_:1})]),_:1},512)])}}}),[["__scopeId","data-v-29ae406d"]]);export{N as default};
