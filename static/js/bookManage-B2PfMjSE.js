import{y as e,r as a,c as t,z as l,R as o,J as s,al as i,B as n,P as u,u as r,O as p,I as d,L as c,E as h,Q as m,a6 as f,aD as b,A as w}from"./vue-BMnUnhjY.js";import{u as _,s as g}from"./index-BT6KgQx3.js";import{e as v,w as k,S as T,a3 as S,a4 as y,E as V,C as U}from"./elementPlus-iRxZk2_b.js";import{_ as C}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as P}from"./tablePage-YHXugbiE.js";import{B as R}from"./statusConfig-Cju3zQbK.js";import{_ as D}from"./_plugin-vue_export-helper-BCo6x5W8.js";const A={class:"book-manage-container common-action-column"},O=["title","onClick"],Y={class:"action-buttons"},I=["onClick"],x=["onClick"],B=["onClick"],j=D(e({__name:"bookManage",setup(e){const D=b(),j=_(),M=j.isAdmin,N={title:"",author:"",publishStatus:"",bookPublishDateRange:[],publishTimesRange:[],updatedTimesRange:[]},F=a(null),$=a([]),q=t(()=>0===$.value.length||$.value.some(e=>"1"===e.publishStatus)),z=e=>g.post("/api/book/list",e),E=e=>{$.value=e},L=()=>{D.push({path:"/modifyBookInfos",query:{mode:"add",tabTitle:encodeURIComponent("新增著作")}})},J=e=>{const a=!e,t=j.getUserInfo.value;if(a&&0===$.value.length)return void V.warning("请选择要删除的著作");if(a&&$.value.some(e=>"1"===e.publishStatus))return void V.warning("已发布的著作不能删除");if(!a&&"1"===e?.publishStatus)return void V.warning("已发布的著作不能删除");if(!M.value)if(a){if($.value.some(e=>e.createUserName!==t?.username))return void V.warning("您只能删除自己创建的著作")}else if(e&&e.createUserName!==t?.username)return void V.warning("您只能删除自己创建的著作");const l=a?$.value.map(e=>e.id):e.id,o=a?`确认删除选中的 ${$.value.length} 条著作信息吗？`:"确认删除该著作信息吗？";U.confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.post("/api/book/delete",{ids:l}).then(()=>{V.success("删除成功"),K(1)})}).catch(()=>{})},K=e=>{F.value&&F.value.getList(e)};return(e,a)=>{const t=i("el-input"),b=i("el-form-item"),_=i("el-col"),j=i("el-option"),$=i("el-select"),Q=i("el-date-picker"),W=i("el-icon"),G=i("el-tooltip"),H=i("el-table-column"),X=i("el-tag");return w(),l("div",A,[o(P,{ref_key:"tablePageRef",ref:F,fetchData:z,initialSearchForm:N,onSelectionChange:E},{"search-form":s(({form:e})=>[o(_,{span:6},{default:s(()=>[o(b,{label:"著作标题"},{default:s(()=>[o(t,{modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,placeholder:"请输入著作标题",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"作者"},{default:s(()=>[o(t,{modelValue:e.author,"onUpdate:modelValue":a=>e.author=a,placeholder:"请输入作者",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"发布状态"},{default:s(()=>[o($,{modelValue:e.publishStatus,"onUpdate:modelValue":a=>e.publishStatus=a,placeholder:"请选择发布状态",clearable:""},{default:s(()=>[(w(!0),l(m,null,f(r(R).list,e=>(w(),d(j,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"著作发布日期"},{default:s(()=>[o(Q,{modelValue:e.bookPublishDateRange,"onUpdate:modelValue":a=>e.bookPublishDateRange=a,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"发布时间"},{default:s(()=>[o(Q,{modelValue:e.publishTimesRange,"onUpdate:modelValue":a=>e.publishTimesRange=a,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:s(()=>[o(b,{label:"更新时间"},{default:s(()=>[o(Q,{modelValue:e.updatedTimesRange,"onUpdate:modelValue":a=>e.updatedTimesRange=a,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),operation:s(()=>[o(G,{content:"新增著作",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(C,{size:"small",type:"primary",onClick:L},{default:s(()=>[o(W,null,{default:s(()=>[o(r(y))]),_:1})]),_:1})]),_:1}),o(G,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(C,{size:"small",type:"danger",disabled:q.value,onClick:a[0]||(a[0]=e=>J())},{default:s(()=>[o(W,null,{default:s(()=>[o(r(S))]),_:1})]),_:1},8,["disabled"])]),_:1})]),default:s(()=>[o(H,{type:"selection",width:"50",fixed:"left"}),o(H,{prop:"title",label:"著作标题",minWidth:"200",showOverflowTooltip:""},{default:s(e=>[n("span",{class:"clickable-title",title:e.row.title,onClick:a=>(e=>{const a=`著作详情【${e.title}】`;D.push({path:"/bookDetail",query:{mode:"view",id:String(e.id),tabTitle:encodeURIComponent(a)}})})(e.row)},u(e.row.title),9,O)]),_:1}),o(H,{prop:"author",label:"作者",width:"120",showOverflowTooltip:""}),o(H,{prop:"publishStatus",label:"发布状态",width:"100",showOverflowTooltip:""},{default:s(e=>[o(X,{type:r(R).getTagType(e.row.publishStatus)},{default:s(()=>[p(u(r(R).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(H,{prop:"bookPublishDate",label:"著作发布日期",width:"120",showOverflowTooltip:""}),o(H,{prop:"publishUserName",label:"发布人",width:"120",showOverflowTooltip:""}),o(H,{prop:"publishTimes",label:"发布时间",width:"180",showOverflowTooltip:""}),o(H,{prop:"updateUserName",label:"更新人",width:"120",showOverflowTooltip:""}),o(H,{prop:"updatedTimes",label:"更新时间",width:"180",showOverflowTooltip:""}),o(H,{prop:"createUserName",label:"创建人",width:"120",showOverflowTooltip:""}),o(H,{prop:"createdTimes",label:"创建时间",width:"180",showOverflowTooltip:""}),o(H,{label:"操作",width:"110",fixed:"right"},{default:s(e=>[n("div",Y,[r(M)?(w(),d(G,{key:0,content:"1"===e.row.publishStatus?"已发布著作不可编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[n("span",{class:h(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:a=>"1"!==e.row.publishStatus&&(e=>{const a=`编辑著作【${e.title}】`;D.push({path:"/modifyBookInfos",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(a)}})})(e.row)},[o(W,{class:"action-icon edit-icon"},{default:s(()=>[o(r(v))]),_:1})],10,I)]),_:2},1032,["content"])):c("",!0),r(M)?(w(),d(G,{key:1,content:"1"===e.row.publishStatus?"下线":"发布",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[n("span",{class:"action-icon-wrapper",onClick:a=>((e,a)=>{const t="publish"===a,l=t?"发布":"下线";U.confirm(`确认${l}该著作吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:t?"info":"warning"}).then(()=>{g.post("/api/book/publish",{id:e.id,action:a}).then(()=>{V.success(`${l}成功`),K(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(W,{class:h(["action-icon","1"===e.row.publishStatus?"unpublish-icon":"publish-icon"])},{default:s(()=>["1"===e.row.publishStatus?(w(),d(r(k),{key:0})):(w(),d(r(T),{key:1}))]),_:2},1032,["class"])],8,x)]),_:2},1032,["content"])):c("",!0),o(G,{content:"1"===e.row.publishStatus?"已发布著作不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[n("span",{class:h(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:a=>"1"!==e.row.publishStatus&&J(e.row)},[o(W,{class:"action-icon delete-icon"},{default:s(()=>[o(r(S))]),_:1})],10,B)]),_:2},1032,["content"])])]),_:1})]),_:1},512)])}}}),[["__scopeId","data-v-7c99da3c"]]);export{j as default};
