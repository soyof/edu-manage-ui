import{y as e,r as a,ay as l,c as t,l as o,h as r,z as d,B as s,L as u,P as n,R as i,J as c,al as p,u as b,O as m,aD as f,A as h}from"./vue-BMnUnhjY.js";import{S as g,g as _,ac as v,ad as V,c as E,E as y}from"./elementPlus-iRxZk2_b.js";import{T as k}from"./tinyMceEditor-EOAlt4H2.js";import{H as U}from"./headerLine-ALaI24G7.js";import{a as w,s as x}from"./index-BT6KgQx3.js";import{u as D}from"./useLoading-D-rekEU2.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";const T={class:"modify-book-container"},Y={class:"card-header"},j={key:0,class:"header-buttons"},L={class:"custom-card box-card"},q={class:"card-body"},M={class:"textarea-wrapper"},C={class:"textarea-wrapper"},R={class:"editor-wrapper"},z={class:"editor-wrapper"},I=P(e({__name:"modifyBookInfos",setup(e){const P=l(),I=f(),A=w(),{loading:B,changeLoading:F,closeLoading:H}=D(),J=a(P.query.mode||"add"),N=a(P.query.id),O=a(),S=t(()=>{if(P.query.tabTitle)return decodeURIComponent(P.query.tabTitle);switch(J.value){case"add":return"新增著作";case"edit":return"编辑著作";case"view":return"查看著作";default:return"著作信息"}}),W=o({id:"",title:"",titleEn:"",author:"",authorEn:"",abstract:"",abstractEn:"",bookPublishDate:"",bookUrl:"",isTranslated:"0",content:"",contentEn:""}),G={title:[{required:!0,message:"请输入著作中文标题",trigger:"blur"},{max:255,message:"标题长度不能超过255个字符",trigger:"blur"}],titleEn:[{max:255,message:"英文标题长度不能超过255个字符",trigger:"blur"}],author:[{required:!0,message:"请输入著作中文作者",trigger:"blur"},{max:255,message:"作者名称长度不能超过255个字符",trigger:"blur"}],authorEn:[{max:255,message:"英文作者名称长度不能超过255个字符",trigger:"blur"}],bookUrl:[{validator:(e,a,l)=>{if(a&&""!==a)try{const e=new URL(a);"http:"===e.protocol||"https:"===e.protocol?l():l(new Error("请输入http或https开头的有效网址"))}catch(t){l(new Error("请输入有效的网址格式"))}else l()},trigger:"blur"}]},K=()=>{O.value?.validate(e=>{if(e){const e="/api/book/save";F(!0),x.post(e,W).then(()=>{y.success({message:("add"===J.value?"新增":"编辑")+"成功",type:"success",duration:2e3});const e=A.getCurTabPath;e&&A.delCurTab(e,I,"/bookManage")}).finally(()=>{H()})}else y.error({message:"请填写必填项",type:"error"})})};return r(()=>{"edit"!==J.value&&"view"!==J.value||N.value&&(F(!0),x.post("/api/book/detail",{id:N.value}).then(e=>{e&&(W.id=e.id,W.title=e.title,W.titleEn=e.titleEn,W.author=e.author,W.authorEn=e.authorEn,W.abstract=e.abstract,W.abstractEn=e.abstractEn,W.bookPublishDate=e.bookPublishDate,W.bookUrl=e.bookUrl,W.isTranslated=e.isTranslated,W.content=e.content,W.contentEn=e.contentEn)}).finally(()=>{H()}))}),(e,a)=>{const l=p("el-button"),t=p("el-tooltip"),o=p("el-input"),r=p("el-form-item"),f=p("el-col"),y=p("el-row"),w=p("el-date-picker"),x=p("el-icon"),D=p("el-radio"),P=p("el-radio-group"),I=p("el-tab-pane"),A=p("el-tabs"),F=p("el-form");return h(),d("div",T,[s("div",Y,[s("h2",null,n(S.value),1),"view"!==J.value?(h(),d("div",j,[i(t,{content:"保存",placement:"top",showAfter:300},{default:c(()=>[i(l,{type:"primary",circle:"",icon:b(g),loading:b(B),onClick:K},null,8,["icon","loading"])]),_:1})])):u("",!0)]),s("div",L,[s("div",q,[i(F,{ref_key:"formRef",ref:O,model:W,rules:G,labelWidth:"150px",labelPosition:"right",disabled:"view"===J.value},{default:c(()=>[i(U,{title:"基本信息",icon:b(_)},null,8,["icon"]),i(y,{gutter:24},{default:c(()=>[i(f,{span:24},{default:c(()=>[i(r,{label:"著作标题（中文）",prop:"title"},{default:c(()=>[i(o,{modelValue:W.title,"onUpdate:modelValue":a[0]||(a[0]=e=>W.title=e),placeholder:"请输入中文标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(y,{gutter:24},{default:c(()=>[i(f,{span:24},{default:c(()=>[i(r,{label:"著作标题（英文）",prop:"titleEn"},{default:c(()=>[i(o,{modelValue:W.titleEn,"onUpdate:modelValue":a[1]||(a[1]=e=>W.titleEn=e),placeholder:"请输入英文标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(y,{gutter:24},{default:c(()=>[i(f,{span:12},{default:c(()=>[i(r,{label:"作者（中文）",prop:"author"},{default:c(()=>[i(o,{modelValue:W.author,"onUpdate:modelValue":a[2]||(a[2]=e=>W.author=e),placeholder:"请输入中文作者名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),i(f,{span:12},{default:c(()=>[i(r,{label:"作者（英文）",prop:"authorEn"},{default:c(()=>[i(o,{modelValue:W.authorEn,"onUpdate:modelValue":a[3]||(a[3]=e=>W.authorEn=e),placeholder:"请输入英文作者名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(y,{gutter:24},{default:c(()=>[i(f,{span:12},{default:c(()=>[i(r,{label:"著作发布日期",prop:"bookPublishDate"},{default:c(()=>[i(w,{modelValue:W.bookPublishDate,"onUpdate:modelValue":a[4]||(a[4]=e=>W.bookPublishDate=e),type:"date",placeholder:"请选择著作发布日期",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),i(f,{span:12},{default:c(()=>[i(r,{label:"著作链接地址",prop:"bookUrl"},{default:c(()=>[i(o,{modelValue:W.bookUrl,"onUpdate:modelValue":a[5]||(a[5]=e=>W.bookUrl=e),placeholder:"请输入著作链接地址",clearable:""},{prefix:c(()=>[i(x,null,{default:c(()=>[i(b(v))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(y,{gutter:24},{default:c(()=>[i(f,{span:12},{default:c(()=>[i(r,{label:"是否译成外文",prop:"isTranslated"},{default:c(()=>[i(P,{modelValue:W.isTranslated,"onUpdate:modelValue":a[6]||(a[6]=e=>W.isTranslated=e)},{default:c(()=>[i(D,{label:"0"},{default:c(()=>[...a[11]||(a[11]=[m("否",-1)])]),_:1}),i(D,{label:"1"},{default:c(()=>[...a[12]||(a[12]=[m("是",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),i(U,{title:"摘要信息",icon:b(V)},null,8,["icon"]),i(r,{label:"摘要",prop:"abstract",class:"content-form-item"},{default:c(()=>[i(A,{type:"border-card",class:"simple-tabs"},{default:c(()=>[i(I,{label:"中文内容"},{default:c(()=>[s("div",M,[i(o,{modelValue:W.abstract,"onUpdate:modelValue":a[7]||(a[7]=e=>W.abstract=e),type:"textarea",rows:6,placeholder:"请输入中文摘要",resize:"none"},null,8,["modelValue"])])]),_:1}),i(I,{label:"英文内容"},{default:c(()=>[s("div",C,[i(o,{modelValue:W.abstractEn,"onUpdate:modelValue":a[8]||(a[8]=e=>W.abstractEn=e),type:"textarea",rows:6,placeholder:"请输入英文摘要",resize:"none"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),i(U,{title:"著作内容",icon:b(E)},null,8,["icon"]),i(r,{label:"内容",prop:"content",class:"content-form-item"},{default:c(()=>[i(A,{type:"border-card",class:"simple-tabs"},{default:c(()=>[i(I,{label:"中文内容"},{default:c(()=>[s("div",R,[i(k,{modelValue:W.content,"onUpdate:modelValue":a[9]||(a[9]=e=>W.content=e),placeholder:"请输入著作内容（中文）",height:500,disabled:"view"===J.value},null,8,["modelValue","disabled"])])]),_:1}),i(I,{label:"英文内容"},{default:c(()=>[s("div",z,[i(k,{modelValue:W.contentEn,"onUpdate:modelValue":a[10]||(a[10]=e=>W.contentEn=e),placeholder:"请输入著作内容（英文）",height:500,disabled:"view"===J.value},null,8,["modelValue","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","disabled"])])])])}}}),[["__scopeId","data-v-51d03ee0"]]);export{I as default};
