import{y as e,r as a,c as l,z as t,R as o,J as i,I as s,L as n,u,al as d,B as p,P as r,O as c,E as m,Q as h,a6 as f,aD as b,A as w}from"./vue-BMnUnhjY.js";import{u as y,s as _}from"./index-BT6KgQx3.js";import{e as g,w as v,S as V,a3 as S,a4 as T,E as U,C as k}from"./elementPlus-iRxZk2_b.js";import{_ as C}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as I}from"./tablePage-YHXugbiE.js";import{D}from"./statusConfig-Cju3zQbK.js";import{u as A}from"./useDictionary-Cg9QFWfd.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";const x={class:"dynamic-manage-container common-action-column"},j=["title","onClick"],B={class:"action-buttons"},P=["onClick"],L=["onClick"],O=["onClick"],$=R(e({__name:"dynamicManage",setup(e){const R=b(),$=y().isAdmin,{dictList:z,getDictLabel:N}=A({dictType:"dynamic_type",autoLoad:!0}),W={dynamicType:"",title:"",publishStatus:"",createUserId:"",updateUserId:"",publishTimesRange:[],updatedTimesRange:[],publishDateRange:[]},Y=a(null),q=a([]),F=l(()=>0===q.value.length||q.value.some(e=>"1"===e.publishStatus)),M=e=>_.post("/api/dynamic/list",e),E=e=>{q.value=e},H=()=>{R.push({path:"/modifyDynamic",query:{mode:"add",tabTitle:encodeURIComponent("新增动态")}})},J=e=>{const a=!e;if(a&&0===q.value.length)return void U.warning("请选择要删除的动态");if(a&&q.value.some(e=>"1"===e.publishStatus))return void U.warning("发布中的动态不能删除");if(!a&&"1"===e?.publishStatus)return void U.warning("发布中的动态不能删除");const l=a?q.value.map(e=>e.id):e.id,t=a?`确认删除选中的 ${q.value.length} 条动态信息吗？`:"确认删除该动态信息吗？";k.confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.post("/api/dynamic/delete",{ids:l}).then(()=>{U.success("删除成功"),K(1)})}).catch(()=>{})},K=e=>{Y.value&&Y.value.getList(e)};return(e,a)=>{const l=d("el-input"),b=d("el-form-item"),y=d("el-col"),A=d("el-option"),q=d("el-select"),Q=d("el-date-picker"),G=d("el-icon"),X=d("el-tooltip"),Z=d("el-table-column"),ee=d("el-tag");return w(),t("div",x,[o(I,{ref_key:"tablePageRef",ref:Y,fetchData:M,initialSearchForm:W,onSelectionChange:E},{"search-form":i(({form:e})=>[o(y,{span:6},{default:i(()=>[o(b,{label:"动态标题"},{default:i(()=>[o(l,{modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,placeholder:"请输入动态标题",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,{span:6},{default:i(()=>[o(b,{label:"类型"},{default:i(()=>[o(q,{modelValue:e.dynamicType,"onUpdate:modelValue":a=>e.dynamicType=a,placeholder:"请选择类型",clearable:""},{default:i(()=>[(w(!0),t(h,null,f(u(z),e=>(w(),s(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),u($)?(w(),s(y,{key:0,span:6},{default:i(()=>[o(b,{label:"发布状态"},{default:i(()=>[o(q,{modelValue:e.publishStatus,"onUpdate:modelValue":a=>e.publishStatus=a,placeholder:"请选择状态",clearable:""},{default:i(()=>[(w(!0),t(h,null,f(u(D).list,e=>(w(),s(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):n("",!0),o(y,{span:6},{default:i(()=>[o(b,{label:"动态发布日期"},{default:i(()=>[o(Q,{modelValue:e.publishDateRange,"onUpdate:modelValue":a=>e.publishDateRange=a,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,{span:6},{default:i(()=>[o(b,{label:"创建人"},{default:i(()=>[o(l,{modelValue:e.createUserId,"onUpdate:modelValue":a=>e.createUserId=a,placeholder:"请输入创建人",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,{span:6},{default:i(()=>[o(b,{label:"更新人"},{default:i(()=>[o(l,{modelValue:e.updateUserId,"onUpdate:modelValue":a=>e.updateUserId=a,placeholder:"请输入更新人",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),n("",!0),n("",!0)]),operation:i(()=>[u($)?(w(),t(h,{key:0},[o(X,{content:"新增动态",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[o(C,{size:"small",type:"primary",onClick:H},{default:i(()=>[o(G,null,{default:i(()=>[o(u(T))]),_:1})]),_:1})]),_:1}),o(X,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[o(C,{size:"small",type:"danger",disabled:F.value,onClick:a[0]||(a[0]=e=>J())},{default:i(()=>[o(G,null,{default:i(()=>[o(u(S))]),_:1})]),_:1},8,["disabled"])]),_:1})],64)):n("",!0)]),default:i(()=>[u($)?(w(),s(Z,{key:0,type:"selection",width:"50",fixed:"left"})):n("",!0),o(Z,{prop:"title",label:"动态标题",minWidth:"200",showOverflowTooltip:""},{default:i(e=>[p("span",{class:"clickable-title",title:e.row.title,onClick:a=>(e=>{const a=`动态详情【${e.title}】`;R.push({path:"/dynamicDetail",query:{id:String(e.id),tabTitle:encodeURIComponent(a)}})})(e.row)},r(e.row.title),9,j)]),_:1}),o(Z,{prop:"dynamicType",label:"动态类型",width:"150",showOverflowTooltip:""},{default:i(e=>[c(r(u(N)(e.row.dynamicType)),1)]),_:1}),o(Z,{prop:"publishStatus",label:"状态",width:"100",align:"center"},{default:i(e=>[o(ee,{type:u(D).getTagType(e.row.publishStatus),size:"small"},{default:i(()=>[c(r(u(D).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(Z,{prop:"publishDate",label:"动态发布日期",width:"120",showOverflowTooltip:""}),o(Z,{prop:"publishUserName",label:"发布人",width:"120"}),o(Z,{prop:"publishTimes",label:"发布时间",minWidth:"180"}),o(Z,{prop:"createUserName",label:"创建人",width:"120"}),o(Z,{prop:"createdTimes",label:"创建时间",minWidth:"180"}),o(Z,{prop:"updateUserName",label:"更新人",width:"120"}),o(Z,{prop:"updatedTimes",label:"更新时间",minWidth:"180"}),u($)?(w(),s(Z,{key:1,label:"操作",width:"110",fixed:"right"},{default:i(e=>[p("div",B,[o(X,{content:"1"===e.row.publishStatus?"发布中的动态不可编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[p("span",{class:m(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:a=>"1"!==e.row.publishStatus&&(e=>{const a=`编辑动态【${e.title}】`;R.push({path:"/modifyDynamic",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(a)}})})(e.row)},[o(G,{class:"action-icon edit-icon"},{default:i(()=>[o(u(g))]),_:1})],10,P)]),_:2},1032,["content"]),o(X,{content:"1"===e.row.publishStatus?"下线":"发布",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[p("span",{class:"action-icon-wrapper",onClick:a=>((e,a)=>{const l="publish"===a,t=l?"发布":"下线";k.confirm(`确定要${t}该动态吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:l?"info":"warning"}).then(()=>{_.post("/api/dynamic/publish",{id:e.id,action:a}).then(()=>{U.success(`${t}成功`),K(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(G,{class:m(["action-icon","1"===e.row.publishStatus?"unpublish-icon":"publish-icon"])},{default:i(()=>["1"===e.row.publishStatus?(w(),s(u(v),{key:0})):(w(),s(u(V),{key:1}))]),_:2},1032,["class"])],8,L)]),_:2},1032,["content"]),o(X,{content:"1"===e.row.publishStatus?"发布中的动态不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[p("span",{class:m(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:a=>"1"!==e.row.publishStatus&&J(e.row)},[o(G,{class:"action-icon delete-icon"},{default:i(()=>[o(u(S))]),_:1})],10,O)]),_:2},1032,["content"])])]),_:1})):n("",!0)]),_:1},512)])}}}),[["__scopeId","data-v-c40ec741"]]);export{$ as default};
