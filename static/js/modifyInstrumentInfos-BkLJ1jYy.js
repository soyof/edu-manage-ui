import{y as e,r as a,c as l,j as t,z as i,R as r,al as o,E as u,J as n,I as d,u as s,O as p,L as m,C as c,P as f,A as g,ay as b,l as h,h as v,B as _,aD as V}from"./vue-BMnUnhjY.js";import{a4 as w,ae as y,E,S as I,g as U,af as k,k as F}from"./elementPlus-iRxZk2_b.js";import{H as P}from"./headerLine-ALaI24G7.js";import{s as S,a as N}from"./index-BT6KgQx3.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{T}from"./tinyMceEditor-EOAlt4H2.js";import{u as L}from"./useLoading-D-rekEU2.js";const j={class:"image-upload-container"},B={key:0,class:"el-upload__tip"},z={key:0},q=x(e({__name:"imageUpload",props:{modelValue:{},multiple:{type:Boolean,default:!1},limit:{default:1},accept:{default:"image/*"},fileSize:{default:5},listType:{default:"picture-card"},disabled:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{emit:b}){const h=e,v=b,_=a(),V=a([]),I=l(()=>h.limit<=V.value.length);t(()=>h.modelValue,e=>{e&&e.length>0?V.value=e.map((e,a)=>({name:e,url:U(e),uid:Date.now()+a,status:"success"})):V.value=[]},{immediate:!0});const U=e=>e?e.startsWith("http")?e:`/api/previewImage?filename=${e}`:"",k=e=>{if(!e.type.startsWith("image/"))return E.error("只能上传图片文件!"),!1;return e.size/1024/1024<h.fileSize||E.error(`图片大小不能超过 ${h.fileSize}MB!`),!1},F=e=>{e.raw&&P(e.raw,e)},P=async(e,a)=>{try{const l=new FormData;l.append("image",e);const t=await S.upload("/api/uploadImage",l);if(!t||!t.url)throw new Error("上传响应数据异常");{const e=V.value.findIndex(e=>e.uid===a.uid);-1!==e&&(V.value[e].url=U(t.url),V.value[e].name=t.url,V.value[e].status="success"),N(),E.success("上传成功")}}catch(l){E.error("上传失败: "+l.message);const e=V.value.findIndex(e=>e.uid===a.uid);-1!==e&&V.value.splice(e,1)}},N=()=>{const e=V.value.filter(e=>"success"===e.status).map(e=>{if(e.url){return new URL(e.url,window.location.origin).searchParams.get("filename")||e.name}return e.name||""}).filter(Boolean);v("update:modelValue",e)},x=e=>{const a=V.value.filter(a=>a.uid!==e.uid&&"success"===a.status).map(e=>{if(e.url){return new URL(e.url,window.location.origin).searchParams.get("filename")||e.name}return e.name||""}).filter(Boolean);v("update:modelValue",a)},T=()=>{E.warning(`最多只能上传 ${h.limit} 张图片`)};return(e,a)=>{const l=o("el-icon"),t=o("el-button"),b=o("el-upload");return g(),i("div",j,[r(b,{ref_key:"uploadRef",ref:_,fileList:V.value,"onUpdate:fileList":a[0]||(a[0]=e=>V.value=e),autoUpload:!1,multiple:e.multiple,limit:e.limit,accept:e.accept,beforeUpload:k,onRemove:x,onExceed:T,listType:e.listType,disabled:e.disabled,class:u({"hide-upload":I.value}),onChange:F},{tip:n(()=>[e.showTip?(g(),i("div",B,[c(e.$slots,"tip",{},()=>[p(" 支持 "+f(e.accept||"jpg/png")+" 格式，单个文件不超过 "+f(e.fileSize)+"MB ",1),e.limit>1?(g(),i("span",z,"，最多上传 "+f(e.limit)+" 张图片",1)):m("",!0)],!0)])):m("",!0)]),default:n(()=>["picture-card"===e.listType?(g(),d(l,{key:0,class:"avatar-uploader-icon"},{default:n(()=>[r(s(w))]),_:1})):(g(),d(t,{key:1,type:"primary",disabled:e.disabled},{default:n(()=>[r(l,null,{default:n(()=>[r(s(y))]),_:1}),a[1]||(a[1]=p(" 选择图片 ",-1))]),_:1},8,["disabled"]))]),_:3},8,["fileList","multiple","limit","accept","listType","disabled","class"])])}}}),[["__scopeId","data-v-954d9eda"]]),R={class:"modify-instrument-container"},C={class:"card-header"},M={key:0,class:"header-buttons"},$={class:"custom-card box-card"},A={class:"card-body"},D={class:"upload-tip"},W=x(e({__name:"modifyInstrumentInfos",setup(e){const t=b(),u=V(),d=N(),{loading:c,changeLoading:w,closeLoading:y}=L(),x=a(t.query.mode||"add"),j=a(t.query.id),B=a(),z=l(()=>{if(t.query.tabTitle)return decodeURIComponent(t.query.tabTitle);switch(x.value){case"add":return"新增仪器";case"edit":return"编辑仪器";case"view":return"查看仪器";default:return"仪器信息"}}),W=h({id:"",instName:"",instNameEn:"",manufacturer:"",manufacturerEn:"",model:"",workingPrinciple:"",workingPrincipleEn:"",applicationScope:"",applicationScopeEn:"",performanceFeatures:"",performanceFeaturesEn:"",otherInfo:"",otherInfoEn:"",imageFiles:[]}),H={instName:[{required:!0,message:"请输入仪器中文名称",trigger:"blur"},{max:255,message:"名称长度不能超过255个字符",trigger:"blur"}],instNameEn:[{max:255,message:"名称长度不能超过255个字符",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入生产厂家中文名称",trigger:"blur"},{max:255,message:"厂家名称长度不能超过255个字符",trigger:"blur"}],manufacturerEn:[{max:255,message:"厂家名称长度不能超过255个字符",trigger:"blur"}],model:[{required:!0,message:"请输入仪器型号",trigger:"blur"},{max:100,message:"型号长度不能超过100个字符",trigger:"blur"}]},J=()=>{B.value?.validate(e=>{if(e){const e="/api/instrument/save";w(!0),S.post(e,W).then(()=>{E.success({message:("add"===x.value?"新增":"编辑")+"成功",type:"success",duration:2e3});const e=d.getCurTabPath;e&&d.delCurTab(e,u,"/instrumentManage")}).finally(()=>{y()})}else E.error({message:"请填写必填项",type:"error"})})};return v(()=>{"edit"!==x.value&&"view"!==x.value||j.value&&(w(!0),S.post("/api/instrument/detail",{id:j.value}).then(e=>{e&&(W.id=e.id,W.instName=e.instName,W.instNameEn=e.instNameEn,W.manufacturer=e.manufacturer,W.manufacturerEn=e.manufacturerEn,W.model=e.model,W.workingPrinciple=e.workingPrinciple,W.workingPrincipleEn=e.workingPrincipleEn,W.applicationScope=e.applicationScope,W.applicationScopeEn=e.applicationScopeEn,W.performanceFeatures=e.performanceFeatures,W.performanceFeaturesEn=e.performanceFeaturesEn,W.otherInfo=e.otherInfo,W.otherInfoEn=e.otherInfoEn,W.imageFiles=e.imageFiles||[])}).finally(()=>{y()}))}),(e,a)=>{const l=o("el-button"),t=o("el-tooltip"),u=o("el-input"),d=o("el-form-item"),b=o("el-col"),h=o("el-row"),v=o("el-text"),V=o("el-tab-pane"),w=o("el-tabs"),y=o("el-form");return g(),i("div",R,[_("div",C,[_("h2",null,f(z.value),1),"view"!==x.value?(g(),i("div",M,[r(t,{content:"保存",placement:"top",showAfter:200,hideAfter:0},{default:n(()=>[r(l,{type:"primary",circle:"",icon:s(I),loading:s(c),onClick:J},null,8,["icon","loading"])]),_:1})])):m("",!0)]),_("div",$,[_("div",A,[r(y,{ref_key:"formRef",ref:B,model:W,rules:H,labelWidth:"150px",labelPosition:"right",disabled:"view"===x.value},{default:n(()=>[r(P,{title:"基本信息",icon:s(U)},null,8,["icon"]),r(h,{gutter:24},{default:n(()=>[r(b,{span:12},{default:n(()=>[r(d,{label:"仪器名称（中文）",prop:"instName"},{default:n(()=>[r(u,{modelValue:W.instName,"onUpdate:modelValue":a[0]||(a[0]=e=>W.instName=e),placeholder:"请输入仪器中文名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),r(b,{span:12},{default:n(()=>[r(d,{label:"仪器名称（英文）",prop:"instNameEn"},{default:n(()=>[r(u,{modelValue:W.instNameEn,"onUpdate:modelValue":a[1]||(a[1]=e=>W.instNameEn=e),placeholder:"请输入仪器英文名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(h,{gutter:24},{default:n(()=>[r(b,{span:12},{default:n(()=>[r(d,{label:"生产厂家（中文）",prop:"manufacturer"},{default:n(()=>[r(u,{modelValue:W.manufacturer,"onUpdate:modelValue":a[2]||(a[2]=e=>W.manufacturer=e),placeholder:"请输入生产厂家中文名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),r(b,{span:12},{default:n(()=>[r(d,{label:"生产厂家（英文）",prop:"manufacturerEn"},{default:n(()=>[r(u,{modelValue:W.manufacturerEn,"onUpdate:modelValue":a[3]||(a[3]=e=>W.manufacturerEn=e),placeholder:"请输入生产厂家英文名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(h,{gutter:24},{default:n(()=>[r(b,{span:12},{default:n(()=>[r(d,{label:"型号",prop:"model"},{default:n(()=>[r(u,{modelValue:W.model,"onUpdate:modelValue":a[4]||(a[4]=e=>W.model=e),placeholder:"请输入仪器型号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(P,{title:"仪器图片",icon:s(k)},null,8,["icon"]),r(d,{label:"仪器图片",prop:"imageFiles"},{default:n(()=>[r(q,{modelValue:W.imageFiles,"onUpdate:modelValue":a[5]||(a[5]=e=>W.imageFiles=e),multiple:!0,limit:5,disabled:"view"===x.value,accept:"image/*",fileSize:5,listType:"picture-card"},null,8,["modelValue","disabled"]),_("div",D,[r(v,{type:"info",size:"small"},{default:n(()=>[...a[14]||(a[14]=[p(" 支持jpg、png、gif格式，单个文件不超过5MB，最多上传5张图片 ",-1)])]),_:1})])]),_:1}),r(P,{title:"技术信息",icon:s(F)},null,8,["icon"]),r(d,{label:"工作原理",prop:"workingPrinciple",class:"tech-item"},{default:n(()=>[r(w,{type:"border-card",class:"simple-tabs"},{default:n(()=>[r(V,{label:"中文内容"},{default:n(()=>[r(T,{modelValue:W.workingPrinciple,"onUpdate:modelValue":a[6]||(a[6]=e=>W.workingPrinciple=e),placeholder:"请输入工作原理（中文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1}),r(V,{label:"英文内容"},{default:n(()=>[r(T,{modelValue:W.workingPrincipleEn,"onUpdate:modelValue":a[7]||(a[7]=e=>W.workingPrincipleEn=e),placeholder:"请输入工作原理（英文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),r(d,{label:"应用范围",prop:"applicationScope",class:"tech-item"},{default:n(()=>[r(w,{type:"border-card",class:"simple-tabs"},{default:n(()=>[r(V,{label:"中文内容"},{default:n(()=>[r(T,{modelValue:W.applicationScope,"onUpdate:modelValue":a[8]||(a[8]=e=>W.applicationScope=e),placeholder:"请输入应用范围（中文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1}),r(V,{label:"英文内容"},{default:n(()=>[r(T,{modelValue:W.applicationScopeEn,"onUpdate:modelValue":a[9]||(a[9]=e=>W.applicationScopeEn=e),placeholder:"请输入应用范围（英文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),r(d,{label:"性能特点",prop:"performanceFeatures",class:"tech-item"},{default:n(()=>[r(w,{type:"border-card",class:"simple-tabs"},{default:n(()=>[r(V,{label:"中文内容"},{default:n(()=>[r(T,{modelValue:W.performanceFeatures,"onUpdate:modelValue":a[10]||(a[10]=e=>W.performanceFeatures=e),placeholder:"请输入性能特点（中文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1}),r(V,{label:"英文内容"},{default:n(()=>[r(T,{modelValue:W.performanceFeaturesEn,"onUpdate:modelValue":a[11]||(a[11]=e=>W.performanceFeaturesEn=e),placeholder:"请输入性能特点（英文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),r(d,{label:"其它说明",prop:"otherInfo",class:"tech-item"},{default:n(()=>[r(w,{type:"border-card",class:"simple-tabs"},{default:n(()=>[r(V,{label:"中文内容"},{default:n(()=>[r(T,{modelValue:W.otherInfo,"onUpdate:modelValue":a[12]||(a[12]=e=>W.otherInfo=e),placeholder:"请输入其它说明（中文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1}),r(V,{label:"英文内容"},{default:n(()=>[r(T,{modelValue:W.otherInfoEn,"onUpdate:modelValue":a[13]||(a[13]=e=>W.otherInfoEn=e),placeholder:"请输入其它说明（英文）",height:300,disabled:"view"===x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","disabled"])])])])}}}),[["__scopeId","data-v-2d4a5727"]]);export{W as default};
