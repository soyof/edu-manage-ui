import{T as e}from"./tablePage-YHXugbiE.js";import{s as l,u as a}from"./index-BT6KgQx3.js";import{u as o}from"./useDictionary-Cg9QFWfd.js";import{I as t}from"./idPhotoUploader-0x0eQTj2.js";import{E as s,i as u,e as i,a0 as r,R as d,a1 as n,a2 as p,v as c,a3 as f,a4 as m,r as v,C as b}from"./elementPlus-iRxZk2_b.js";import{y as g,r as h,c as _,j as w,K as y,ar as V,z as U,R as I,al as A,J as k,Q as T,a6 as C,I as O,u as D,B as L,L as $,O as H,P as j,A as x,E as B,M as P,aD as R}from"./vue-BMnUnhjY.js";import{_ as W}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{_ as E}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import"./useLoading-D-rekEU2.js";const S=[{value:"admin",label:"管理员"},{value:"user",label:"普通用户"}],z={class:"dialog-footer"},F=W(g({__name:"modifyUserDialog",props:{visible:{type:Boolean,default:!1},config:{type:Object,default:()=>({type:"A",info:{}})}},emits:["update:visible","success"],setup(e,{emit:a}){const{dictList:u}=o({dictType:"user_title",autoLoad:!0}),i=e,r=a,d=h(i.visible),n=h(!1),p=h(),c=_(()=>"V"===i.config.type),f=_(()=>{switch(i.config.type){case"A":return"新增用户";case"E":return"编辑用户";case"V":return"查看用户";default:return"用户信息"}}),m=h({userId:"",username:"",email:"",phone:"",title:"",role:"",labHomepage:"",personalHomepage:"",tags:[],idPic:""}),v=h([]),b=h({userId:[{required:!0,message:"请输入用户编号",trigger:"blur"},{pattern:/^(?![0-9]+$)[a-zA-Z0-9]+$/,message:"用户编号只能包含英文+数字或纯英文",trigger:"blur"}],username:[{required:!0,message:"请输入用户名称",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],labHomepage:[{type:"url",message:"请输入正确的URL地址",trigger:"blur"}],personalHomepage:[{type:"url",message:"请输入正确的URL地址",trigger:"blur"}]});w(()=>i.visible,e=>{d.value=e,e&&"A"!==i.config.type?g():B()}),w(()=>d.value,e=>{r("update:visible",e)});const g=()=>{if(i.config.info)for(const l in m.value)if(Object.prototype.hasOwnProperty.call(i.config.info,l))if("tags"===l){if("string"==typeof i.config.info[l]&&i.config.info[l])try{m.value[l]=i.config.info[l].split(",").map(e=>e.trim()).filter(Boolean)}catch(e){m.value[l]=[]}else Array.isArray(i.config.info[l])?m.value[l]=[...i.config.info[l]]:m.value[l]=[];m.value.tags.forEach(e=>{e&&!v.value.includes(e)&&v.value.push(e)})}else m.value[l]=i.config.info[l]},B=()=>{for(const e in m.value)m.value[e]="tags"===e?[]:""},P=e=>{m.value.idPic=e},R=()=>{s.error("证件照上传失败")},W=()=>{p.value?.resetFields(),B(),d.value=!1},E=async()=>{p.value&&await p.value.validate(async e=>{if(e){n.value=!0;const e="A"===i.config.type?"/api/createUser":"/api/updateUser",a={...m.value};void 0!==a.title&&null!==a.title||(a.title=""),void 0!==a.role&&null!==a.role||(a.role=""),l.post(e,a).then(()=>{s.success("A"===i.config.type?"创建成功":"更新成功"),r("success"),W()}).finally(()=>{n.value=!1})}})};return(l,a)=>{const o=A("el-input"),s=A("el-form-item"),i=A("el-option"),r=A("el-select"),g=A("el-form"),h=A("el-button"),_=A("el-dialog"),w=V("loading");return y((x(),U("div",null,[I(_,{modelValue:d.value,"onUpdate:modelValue":a[10]||(a[10]=e=>d.value=e),title:f.value,width:"600px",appendToBody:"",draggable:"",closeOnClickModal:!1,onClose:W},{footer:k(()=>[L("span",z,[I(h,{type:c.value?"primary":"default",onClick:W},{default:k(()=>[H(j(c.value?"关闭":"取消"),1)]),_:1},8,["type"]),c.value?$("",!0):(x(),O(h,{key:0,loading:n.value,type:"primary",onClick:E},{default:k(()=>[...a[11]||(a[11]=[H(" 确定 ",-1)])]),_:1},8,["loading"]))])]),default:k(()=>[I(g,{ref_key:"formRef",ref:p,model:m.value,rules:b.value,labelWidth:"100px",statusIcon:""},{default:k(()=>[I(s,{label:"用户编号",prop:"userId"},{default:k(()=>[I(o,{modelValue:m.value.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.userId=e),placeholder:"请输入用户编号（英文+数字或纯英文）",disabled:"A"!==e.config.type},null,8,["modelValue","disabled"])]),_:1}),I(s,{label:"用户名称",prop:"username"},{default:k(()=>[I(o,{modelValue:m.value.username,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.username=e),placeholder:"请输入用户名称",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),I(s,{label:"邮箱地址",prop:"email"},{default:k(()=>[I(o,{modelValue:m.value.email,"onUpdate:modelValue":a[2]||(a[2]=e=>m.value.email=e),placeholder:"请输入邮箱地址",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),I(s,{label:"手机号码",prop:"phone"},{default:k(()=>[I(o,{modelValue:m.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value.phone=e),placeholder:"请输入手机号码",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),I(s,{label:"职称",prop:"title"},{default:k(()=>[I(r,{modelValue:m.value.title,"onUpdate:modelValue":a[4]||(a[4]=e=>m.value.title=e),filterable:"",clearable:"",placeholder:"请选择职称",disabled:c.value},{default:k(()=>[(x(!0),U(T,null,C(D(u),e=>(x(),O(i,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),I(s,{label:"角色",prop:"role"},{default:k(()=>[I(r,{modelValue:m.value.role,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value.role=e),filterable:"",clearable:"",placeholder:"请选择角色",disabled:c.value},{default:k(()=>[(x(!0),U(T,null,C(D(S),e=>(x(),O(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),I(s,{label:"实验室主页",prop:"labHomepage"},{default:k(()=>[I(o,{modelValue:m.value.labHomepage,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value.labHomepage=e),placeholder:"请输入实验室主页URL",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),I(s,{label:"个人主页",prop:"personalHomepage"},{default:k(()=>[I(o,{modelValue:m.value.personalHomepage,"onUpdate:modelValue":a[7]||(a[7]=e=>m.value.personalHomepage=e),placeholder:"请输入个人主页URL",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),I(s,{label:"用户标签",prop:"tags"},{default:k(()=>[I(r,{modelValue:m.value.tags,"onUpdate:modelValue":a[8]||(a[8]=e=>m.value.tags=e),multiple:"",clearable:"",filterable:"",allowCreate:"",defaultFirstOption:"",placeholder:"请选择或输入标签",disabled:c.value},{default:k(()=>[(x(!0),U(T,null,C(v.value,e=>(x(),O(i,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),I(s,{label:"证件照",prop:"idPic"},{default:k(()=>[I(t,{modelValue:m.value.idPic,"onUpdate:modelValue":a[9]||(a[9]=e=>m.value.idPic=e),userId:m.value.userId||"",disabled:c.value,onUploadSuccess:P,onUploadError:R},null,8,["modelValue","userId","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])),[[w,n.value]])}}}),[["__scopeId","data-v-786faa46"]]),q={class:"user-manage common-action-column"},M={class:"operation-btns"},J={class:"action-buttons"},K=["onClick"],N=["onClick"],Q=["onClick"],Z=["onClick"],G=["onClick"],X=["onClick"],Y=W(g({__name:"userManage",setup(t){const{dictList:g,getDictLabel:_}=o({dictType:"user_title",autoLoad:!0}),w=R(),y=a(),V={username:"",email:"",phone:"",title:"",status:"",isDisplay:""},$=h(!1),W=h({type:"A",info:{}}),z=h(),Y=e=>l.post("/api/getAllUsersInfos",e),ee=()=>{$.value=!0,W.value={type:"A",info:{}}},le=e=>{const l={...e};return"string"==typeof l.tags&&l.tags?l.tags=l.tags.split(",").map(e=>e.trim()).filter(Boolean):Array.isArray(l.tags)||(l.tags=[]),l},ae=()=>{z.value?.getList()},oe=()=>{w.push("/userSortSetting")};return(a,o)=>{const t=A("el-input"),h=A("el-form-item"),R=A("el-col"),te=A("el-option"),se=A("el-select"),ue=A("el-icon"),ie=A("el-tooltip"),re=A("el-table-column"),de=A("el-tag");return x(),U("div",q,[I(e,{ref_key:"tablePageRef",ref:z,initialSearchForm:V,fetchData:Y},{"search-form":k(({form:e})=>[I(R,{span:6},{default:k(()=>[I(h,{label:"用户名",prop:"username"},{default:k(()=>[I(t,{modelValue:e.username,"onUpdate:modelValue":l=>e.username=l,placeholder:"请输入用户名",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),I(R,{span:6},{default:k(()=>[I(h,{label:"邮箱",prop:"email"},{default:k(()=>[I(t,{modelValue:e.email,"onUpdate:modelValue":l=>e.email=l,placeholder:"请输入邮箱",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),I(R,{span:6},{default:k(()=>[I(h,{label:"职称",prop:"title"},{default:k(()=>[I(se,{modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,filterable:"",clearable:"",placeholder:"请选择职称"},{default:k(()=>[(x(!0),U(T,null,C(D(g),e=>(x(),O(te,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),I(R,{span:6},{default:k(()=>[I(h,{label:"角色",prop:"role"},{default:k(()=>[I(se,{modelValue:e.role,"onUpdate:modelValue":l=>e.role=l,filterable:"",clearable:"",placeholder:"请选择角色"},{default:k(()=>[(x(!0),U(T,null,C(D(S),e=>(x(),O(te,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),I(R,{span:6},{default:k(()=>[I(h,{label:"状态",prop:"status"},{default:k(()=>[I(se,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,clearable:"",placeholder:"请选择状态"},{default:k(()=>[I(te,{label:"启用",value:"1"}),I(te,{label:"禁用",value:"0"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),I(R,{span:6},{default:k(()=>[I(h,{label:"门户展示",prop:"isDisplay"},{default:k(()=>[I(se,{modelValue:e.isDisplay,"onUpdate:modelValue":l=>e.isDisplay=l,clearable:"",placeholder:"请选择门户展示状态"},{default:k(()=>[I(te,{label:"展示",value:"1"}),I(te,{label:"不展示",value:"0"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),operation:k(()=>[L("div",M,[I(ie,{content:"新增用户",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[I(E,{size:"small",type:"primary",onClick:ee},{default:k(()=>[I(ue,null,{default:k(()=>[I(D(m))]),_:1})]),_:1})]),_:1}),I(ie,{content:"用户排序设置",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[I(E,{size:"small",type:"success",onClick:oe},{default:k(()=>[I(ue,null,{default:k(()=>[I(D(v))]),_:1})]),_:1})]),_:1})])]),default:k(()=>[I(re,{prop:"userId",label:"用户编号",width:"120",showOverflowTooltip:""}),I(re,{prop:"username",label:"用户名",width:"120",showOverflowTooltip:""}),I(re,{prop:"title",label:"职称",width:"120",showOverflowTooltip:""},{default:k(e=>[H(j(D(_)(e.row.title)||e.row.title),1)]),_:1}),I(re,{prop:"status",label:"状态",width:"100",showOverflowTooltip:""},{default:k(e=>[I(de,{type:e.row.status?"success":"danger"},{default:k(()=>[H(j(e.row.status?"已启用":"已禁用"),1)]),_:2},1032,["type"])]),_:1}),I(re,{prop:"isDisplay",label:"门户展示",width:"100",showOverflowTooltip:""},{default:k(e=>[I(de,{type:e.row.isDisplay?"primary":"info"},{default:k(()=>[H(j(e.row.isDisplay?"已展示":"未展示"),1)]),_:2},1032,["type"])]),_:1}),I(re,{prop:"email",label:"邮箱",minWidth:"180",showOverflowTooltip:""}),I(re,{prop:"phone",label:"手机号",width:"120",showOverflowTooltip:""}),I(re,{prop:"tags",label:"标签",minWidth:"120",showOverflowTooltip:""}),I(re,{prop:"role",label:"角色",minWidth:"120",showOverflowTooltip:""},{default:k(e=>[H(j("admin"===e.row.role?"管理员":"普通用户"),1)]),_:1}),I(re,{prop:"labHomepage",label:"实验室主页",minWidth:"120",showOverflowTooltip:""}),I(re,{prop:"personalHomepage",label:"个人主页",minWidth:"120",showOverflowTooltip:""}),I(re,{prop:"createdTimes",label:"创建时间",minWidth:"180",showOverflowTooltip:""}),I(re,{prop:"updatedTimes",label:"更新时间",minWidth:"180",showOverflowTooltip:""}),I(re,{prop:"opera",label:"操作",width:"160",fixed:"right",showOverflowTooltip:""},{default:k(e=>[L("div",J,[I(ie,{content:"查看详情",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[L("span",{class:"action-icon-wrapper",onClick:l=>{return a=e.row,$.value=!0,void(W.value={type:"V",info:le(a)});var a}},[I(ue,{class:"action-icon info-icon"},{default:k(()=>[I(D(u))]),_:1})],8,K)]),_:2},1024),I(ie,{content:"基本信息编辑",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[L("span",{class:"action-icon-wrapper",onClick:l=>{return a=e.row,$.value=!0,void(W.value={type:"E",info:le(a)});var a}},[I(ue,{class:"action-icon edit-icon"},{default:k(()=>[I(D(i))]),_:1})],8,N)]),_:2},1024),I(ie,{content:"学术档案",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[L("span",{class:"action-icon-wrapper",onClick:l=>{return a=e.row,void w.push({path:"/modifyUserOtherInfos",query:{userId:a.userId,userName:a.username,tabTitle:encodeURIComponent(`【${a.username}】学术档案`)}});var a}},[I(ue,{class:"action-icon school-icon"},{default:k(()=>[I(D(r))]),_:1})],8,Q)]),_:2},1024),I(ie,{content:e.row.status?"禁用":"启用",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[L("span",{class:"action-icon-wrapper",onClick:a=>(e=>{const a=y.userInfo?.userId;if(a===e.userId)return void s.warning("不能修改自己的账号状态");const o=!e.status,t=o?"启用":"禁用";b.confirm(`确认${t}【${e.username}_${e.userId}】用户吗？`,`${t}确认`,{confirmButtonText:"确认",cancelButtonText:"取消",type:o?"success":"warning"}).then(()=>{l.post("/api/updateUserStatus",{userId:e.userId,status:o?1:0}).then(()=>{s.success(`${t}成功`),z.value?.getList()})})})(e.row)},[I(ue,{class:B(["action-icon",e.row.status?"lock-icon":"unlock-icon"])},{default:k(()=>[(x(),O(P(e.row.status?D(d):D(n))))]),_:2},1032,["class"])],8,Z)]),_:2},1032,["content"]),I(ie,{content:e.row.isDisplay?"取消门户展示":"设为门户展示",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[L("span",{class:"action-icon-wrapper",onClick:a=>(e=>{const a=e.isDisplay?"不展示":"展示";b.confirm(`确认将用户【${e.username}_${e.userId}】在门户页面${a}吗？`,`门户${a}确认`,{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(()=>{l.post("/api/toggleUserDisplay",{userId:e.userId}).then(()=>{s.success(`设置${a}成功`),z.value?.getList()})})})(e.row)},[I(ue,{class:B(["action-icon",e.row.isDisplay?"hide-icon":"show-icon"])},{default:k(()=>[(x(),O(P(e.row.isDisplay?D(p):D(c))))]),_:2},1032,["class"])],8,G)]),_:2},1032,["content"]),I(ie,{content:"删除",placement:"top",showAfter:200,hideAfter:0},{default:k(()=>[L("span",{class:"action-icon-wrapper",onClick:a=>{return o=e.row,void b.confirm(`确认删除【${o.username}_${o.userId}】用户吗？`,"删除确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{l.post("/api/deleteUser",{userId:o.userId}).then(()=>{s.success("删除成功"),z.value?.getList()})});var o}},[I(ue,{class:"action-icon delete-icon"},{default:k(()=>[I(D(f))]),_:1})],8,X)]),_:2},1024)])]),_:1})]),_:1},512),I(F,{visible:$.value,"onUpdate:visible":o[0]||(o[0]=e=>$.value=e),config:W.value,onSuccess:ae},null,8,["visible","config"])])}}}),[["__scopeId","data-v-91316c94"]]);export{Y as default};
