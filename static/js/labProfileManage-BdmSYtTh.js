import{y as e,r as l,c as a,z as t,R as o,J as i,I as s,L as u,u as n,al as d,B as p,P as r,O as c,E as f,Q as m,a6 as h,aD as b,A as w}from"./vue-BMnUnhjY.js";import{u as _,s as g}from"./index-BT6KgQx3.js";import{e as y,w as v,S as T,a3 as V,a4 as S,E as U,C as k}from"./elementPlus-iRxZk2_b.js";import{_ as C}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as I}from"./tablePage-YHXugbiE.js";import{P}from"./statusConfig-Cju3zQbK.js";import{u as A}from"./useDictionary-Cg9QFWfd.js";import{_ as O}from"./_plugin-vue_export-helper-BCo6x5W8.js";const R={class:"lab-profile-manage-container common-action-column"},x=["title","onClick"],D={class:"action-buttons"},j=["onClick"],Y=["onClick"],L=["onClick"],B=O(e({__name:"labProfileManage",setup(e){const O=b(),B=_().isAdmin,{dictList:M,getDictLabel:$}=A({dictType:"intro_type",autoLoad:!0}),F={profileType:"",title:"",publishStatus:"",createUserId:"",updateUserId:"",publishTimesRange:[],updatedTimesRange:[]},N=l(null),W=l([]),q=a(()=>0===W.value.length||W.value.some(e=>"1"===e.publishStatus)),z=e=>g.post("/api/labProfile/list",e),E=e=>{W.value=e},H=()=>{O.push({path:"/modifyLabProfile",query:{mode:"add",tabTitle:encodeURIComponent("新增简介")}})},J=e=>{const l=!e;if(l&&0===W.value.length)return void U.warning("请选择要删除的简介");if(l&&W.value.some(e=>"1"===e.publishStatus))return void U.warning("生效中的简介不能删除");if(!l&&"1"===e?.publishStatus)return void U.warning("生效中的简介不能删除");const a=l?W.value.map(e=>e.id):e.id,t=l?`确认删除选中的 ${W.value.length} 条简介吗？`:"确认删除该简介吗？";k.confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.post("/api/labProfile/delete",{ids:a}).then(()=>{U.success("删除成功"),K(1)})}).catch(()=>{})},K=e=>{N.value&&N.value.getList(e)};return(e,l)=>{const a=d("el-input"),b=d("el-form-item"),_=d("el-col"),A=d("el-option"),W=d("el-select"),Q=d("el-date-picker"),G=d("el-icon"),X=d("el-tooltip"),Z=d("el-table-column"),ee=d("el-tag");return w(),t("div",R,[o(I,{ref_key:"tablePageRef",ref:N,fetchData:z,initialSearchForm:F,onSelectionChange:E},{"search-form":i(({form:e})=>[o(_,{span:6},{default:i(()=>[o(b,{label:"简介标题"},{default:i(()=>[o(a,{modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,placeholder:"请输入简介标题",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(b,{label:"类型"},{default:i(()=>[o(W,{modelValue:e.profileType,"onUpdate:modelValue":l=>e.profileType=l,placeholder:"请选择类型",clearable:""},{default:i(()=>[(w(!0),t(m,null,h(n(M),e=>(w(),s(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),n(B)?(w(),s(_,{key:0,span:6},{default:i(()=>[o(b,{label:"发布状态"},{default:i(()=>[o(W,{modelValue:e.publishStatus,"onUpdate:modelValue":l=>e.publishStatus=l,placeholder:"请选择状态",clearable:""},{default:i(()=>[(w(!0),t(m,null,h(n(P).list,e=>(w(),s(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):u("",!0),o(_,{span:6},{default:i(()=>[o(b,{label:"创建人"},{default:i(()=>[o(a,{modelValue:e.createUserId,"onUpdate:modelValue":l=>e.createUserId=l,placeholder:"请输入创建人",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(b,{label:"更新人"},{default:i(()=>[o(a,{modelValue:e.updateUserId,"onUpdate:modelValue":l=>e.updateUserId=l,placeholder:"请输入更新人",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(b,{label:"发布时间"},{default:i(()=>[o(Q,{modelValue:e.publishTimesRange,"onUpdate:modelValue":l=>e.publishTimesRange=l,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(_,{span:6},{default:i(()=>[o(b,{label:"更新时间"},{default:i(()=>[o(Q,{modelValue:e.updatedTimesRange,"onUpdate:modelValue":l=>e.updatedTimesRange=l,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),operation:i(()=>[n(B)?(w(),t(m,{key:0},[o(X,{content:"新增简介",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[o(C,{size:"small",type:"primary",onClick:H},{default:i(()=>[o(G,null,{default:i(()=>[o(n(S))]),_:1})]),_:1})]),_:1}),o(X,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[o(C,{size:"small",type:"danger",disabled:q.value,onClick:l[0]||(l[0]=e=>J())},{default:i(()=>[o(G,null,{default:i(()=>[o(n(V))]),_:1})]),_:1},8,["disabled"])]),_:1})],64)):u("",!0)]),default:i(()=>[n(B)?(w(),s(Z,{key:0,type:"selection",width:"50",fixed:"left"})):u("",!0),o(Z,{prop:"title",label:"简介标题",minWidth:"200",showOverflowTooltip:""},{default:i(e=>[p("span",{class:"clickable-title",title:e.row.title,onClick:l=>(e=>{const l=`简介详情【${e.title}】`;O.push({path:"/labProfileDetail",query:{id:String(e.id),tabTitle:encodeURIComponent(l)}})})(e.row)},r(e.row.title),9,x)]),_:1}),o(Z,{prop:"profileType",label:"简介类型",width:"150",showOverflowTooltip:""},{default:i(e=>[c(r(n($)(e.row.profileType)),1)]),_:1}),o(Z,{prop:"publishStatus",label:"发布状态",width:"100",showOverflowTooltip:""},{default:i(e=>[o(ee,{type:n(P).getTagType(e.row.publishStatus)},{default:i(()=>[c(r(n(P).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(Z,{prop:"publishUserName",label:"发布人",width:"120",showOverflowTooltip:""}),o(Z,{prop:"publishTimes",label:"发布时间",minWidth:"180",showOverflowTooltip:""}),o(Z,{prop:"updateUserName",label:"更新人",width:"120",showOverflowTooltip:""}),o(Z,{prop:"updatedTimes",label:"更新时间",minWidth:"180",showOverflowTooltip:""}),o(Z,{prop:"createUserName",label:"创建人",width:"120",showOverflowTooltip:""}),o(Z,{prop:"createdTimes",label:"创建时间",minWidth:"180",showOverflowTooltip:""}),n(B)?(w(),s(Z,{key:1,label:"操作",width:"110",fixed:"right"},{default:i(e=>[p("div",D,[o(X,{content:"1"===e.row.publishStatus?"生效中的简介不可编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[p("span",{class:f(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:l=>"1"!==e.row.publishStatus&&(e=>{const l=`编辑简介【${e.title}】`;O.push({path:"/modifyLabProfile",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(l)}})})(e.row)},[o(G,{class:"action-icon edit-icon"},{default:i(()=>[o(n(y))]),_:1})],10,j)]),_:2},1032,["content"]),o(X,{content:"1"===e.row.publishStatus?"下线":"发布",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[p("span",{class:"action-icon-wrapper",onClick:l=>((e,l)=>{const a="publish"===l,t=a?"发布":"下线",o=a?`发布新简介后，当前生效中的【${$(e.profileType)}】简介将会被下线。确定要发布吗？`:"确定要将该简介下线吗？下线后将不再生效";k.confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:a?"info":"warning"}).then(()=>{g.post("/api/labProfile/publish",{id:e.id,action:l}).then(()=>{U.success(`${t}成功`),K(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(G,{class:f(["action-icon","1"===e.row.publishStatus?"unpublish-icon":"publish-icon"])},{default:i(()=>["1"===e.row.publishStatus?(w(),s(n(v),{key:0})):(w(),s(n(T),{key:1}))]),_:2},1032,["class"])],8,Y)]),_:2},1032,["content"]),o(X,{content:"1"===e.row.publishStatus?"生效中的简介不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:i(()=>[p("span",{class:f(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:l=>"1"!==e.row.publishStatus&&J(e.row)},[o(G,{class:"action-icon delete-icon"},{default:i(()=>[o(n(V))]),_:1})],10,L)]),_:2},1032,["content"])])]),_:1})):u("",!0)]),_:1},512)])}}}),[["__scopeId","data-v-0f38a34f"]]);export{B as default};
