import{y as e,r as l,ay as a,c as t,l as r,h as u,z as o,B as s,L as d,P as i,R as n,J as p,al as c,u as m,Q as b,a6 as f,I as h,aD as v,A as g}from"./vue-BMnUnhjY.js";import{S as _,g as V,ac as E,ad as y,c as j,E as w}from"./elementPlus-iRxZk2_b.js";import{T as U}from"./tinyMceEditor-EOAlt4H2.js";import{H as x}from"./headerLine-ALaI24G7.js";import{a as P,s as T}from"./index-BT6KgQx3.js";import{u as C}from"./useLoading-D-rekEU2.js";import{a as L}from"./useDictionary-Cg9QFWfd.js";import{_ as M}from"./_plugin-vue_export-helper-BCo6x5W8.js";const Y={class:"modify-paper-container"},k={class:"card-header"},S={key:0,class:"header-buttons"},q={class:"custom-card box-card"},D={class:"card-body"},I={class:"editor-wrapper"},F={class:"editor-wrapper"},R={class:"editor-wrapper"},B={class:"editor-wrapper"},A=M(e({__name:"modifyPaperInfos",setup(e){const M=a(),A=v(),H=P(),{loading:O,changeLoading:z,closeLoading:J}=C(),{dictList:N}=L("paper_submission_status",!0),Q=l([]),W=l([]),G=l([]),K=l([]),X=l(M.query.mode||"add"),Z=l(M.query.id),$=l(),ee=t(()=>{if(M.query.tabTitle)return decodeURIComponent(M.query.tabTitle);switch(X.value){case"add":return"新增论文";case"edit":return"编辑论文";case"view":return"查看论文";default:return"论文信息"}}),le=r({id:"",title:"",titleEn:"",authors:"",authorsEn:"",journal:"",journalEn:"",abstract:"",abstractEn:"",paperPublishTimes:"",originalUrl:"",content:"",contentEn:"",submissionStatus:""}),ae={title:[{required:!0,message:"请输入论文中文标题",trigger:"blur"},{max:255,message:"标题长度不能超过255个字符",trigger:"blur"}],titleEn:[{max:255,message:"标题长度不能超过255个字符",trigger:"blur"}],authors:[{required:!0,message:"请输入作者",trigger:"blur"},{max:500,message:"作者长度不能超过500个字符",trigger:"blur"}],authorsEn:[{max:500,message:"作者长度不能超过500个字符",trigger:"blur"}],journal:[{max:255,message:"期刊名称长度不能超过255个字符",trigger:"blur"}],journalEn:[{max:255,message:"期刊名称长度不能超过255个字符",trigger:"blur"}],originalUrl:[{validator:(e,l,a)=>{if(!l||""===l)return void a();const t=e=>{try{const l=new URL(e);return"http:"===l.protocol||"https:"===l.protocol}catch{return!1}};t(l)||t("http://"+l)?a():a(new Error("请输入有效的网址格式"))},trigger:"blur"}]},te=()=>{$.value?.validate(e=>{if(e){const e="/api/paper/save";z(!0),T.post(e,le).then(()=>{w.success({message:("add"===X.value?"新增":"编辑")+"成功",type:"success",duration:2e3});const e=H.getCurTabPath;e&&H.delCurTab(e,A,"/paperManage")}).finally(()=>{J()})}else w.error({message:"请填写必填项",type:"error"})})},re=()=>{le.authors=G.value.join(",")},ue=()=>{le.authorsEn=K.value.join(",")},oe=()=>{le.authors?(G.value=le.authors.split(",").map(e=>e.trim()).filter(Boolean),G.value.forEach(e=>{Q.value.includes(e)||Q.value.push(e)})):G.value=[],le.authorsEn?(K.value=le.authorsEn.split(",").map(e=>e.trim()).filter(Boolean),K.value.forEach(e=>{W.value.includes(e)||W.value.push(e)})):K.value=[]};return u(()=>{"edit"===X.value||"view"===X.value?Z.value&&(z(!0),T.post("/api/paper/detail",{id:Z.value}).then(e=>{e&&(le.id=e.id,le.title=e.title,le.titleEn=e.titleEn,le.authors=e.authors||"未知作者",le.authorsEn=e.authorsEn||"",le.journal=e.journal||"",le.journalEn=e.journalEn||"",le.abstract=e.abstract,le.abstractEn=e.abstractEn,le.paperPublishTimes=e.paperPublishTimes,le.originalUrl=e.originalUrl,le.content=e.content,le.contentEn=e.contentEn,le.submissionStatus=e.submissionStatus,oe())}).finally(()=>{J()})):oe()}),(e,l)=>{const a=c("el-button"),t=c("el-tooltip"),r=c("el-input"),u=c("el-form-item"),v=c("el-col"),w=c("el-row"),P=c("el-option"),T=c("el-select"),C=c("el-date-picker"),L=c("el-icon"),M=c("el-tab-pane"),A=c("el-tabs"),H=c("el-form");return g(),o("div",Y,[s("div",k,[s("h2",null,i(ee.value),1),"view"!==X.value?(g(),o("div",S,[n(t,{content:"保存",placement:"top",showAfter:300},{default:p(()=>[n(a,{type:"primary",circle:"",icon:m(_),loading:m(O),onClick:te},null,8,["icon","loading"])]),_:1})])):d("",!0)]),s("div",q,[s("div",D,[n(H,{ref_key:"formRef",ref:$,model:le,rules:ae,labelWidth:"150px",labelPosition:"right",disabled:"view"===X.value},{default:p(()=>[n(x,{title:"基本信息",icon:m(V)},null,8,["icon"]),n(w,{gutter:24},{default:p(()=>[n(v,{span:24},{default:p(()=>[n(u,{label:"论文标题（中文）",prop:"title"},{default:p(()=>[n(r,{modelValue:le.title,"onUpdate:modelValue":l[0]||(l[0]=e=>le.title=e),placeholder:"请输入中文标题",clearable:"",maxlength:"255"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(w,{gutter:24},{default:p(()=>[n(v,{span:24},{default:p(()=>[n(u,{label:"论文标题（英文）",prop:"titleEn"},{default:p(()=>[n(r,{modelValue:le.titleEn,"onUpdate:modelValue":l[1]||(l[1]=e=>le.titleEn=e),placeholder:"请输入英文标题",clearable:"",maxlength:"255"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(w,{gutter:24},{default:p(()=>[n(v,{span:12},{default:p(()=>[n(u,{label:"作者（中文）",prop:"authors"},{default:p(()=>[n(T,{modelValue:G.value,"onUpdate:modelValue":l[2]||(l[2]=e=>G.value=e),multiple:"",clearable:"",filterable:"",allowCreate:"",defaultFirstOption:"",placeholder:"请选择或输入作者，回车确认",disabled:"view"===X.value,onChange:re},{default:p(()=>[(g(!0),o(b,null,f(Q.value,e=>(g(),h(P,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),n(v,{span:12},{default:p(()=>[n(u,{label:"作者（英文）",prop:"authorsEn"},{default:p(()=>[n(T,{modelValue:K.value,"onUpdate:modelValue":l[3]||(l[3]=e=>K.value=e),multiple:"",clearable:"",filterable:"",allowCreate:"",defaultFirstOption:"",placeholder:"请选择或输入英文作者，回车确认",disabled:"view"===X.value,onChange:ue},{default:p(()=>[(g(!0),o(b,null,f(W.value,e=>(g(),h(P,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),n(w,{gutter:24},{default:p(()=>[n(v,{span:12},{default:p(()=>[n(u,{label:"期刊名称（中文）",prop:"journal"},{default:p(()=>[n(r,{modelValue:le.journal,"onUpdate:modelValue":l[4]||(l[4]=e=>le.journal=e),placeholder:"请输入期刊名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),n(v,{span:12},{default:p(()=>[n(u,{label:"期刊名称（英文）",prop:"journalEn"},{default:p(()=>[n(r,{modelValue:le.journalEn,"onUpdate:modelValue":l[5]||(l[5]=e=>le.journalEn=e),placeholder:"请输入英文期刊名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(w,{gutter:24},{default:p(()=>[n(v,{span:12},{default:p(()=>[n(u,{label:"文献发布时间",prop:"paperPublishTimes"},{default:p(()=>[n(C,{modelValue:le.paperPublishTimes,"onUpdate:modelValue":l[6]||(l[6]=e=>le.paperPublishTimes=e),type:"date",placeholder:"请选择文献原始发布时间",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),n(v,{span:12},{default:p(()=>[n(u,{label:"投稿状态",prop:"submissionStatus"},{default:p(()=>[n(T,{modelValue:le.submissionStatus,"onUpdate:modelValue":l[7]||(l[7]=e=>le.submissionStatus=e),placeholder:"请选择投稿状态",clearable:""},{default:p(()=>[(g(!0),o(b,null,f(m(N),e=>(g(),h(P,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(w,{gutter:24},{default:p(()=>[n(v,{span:24},{default:p(()=>[n(u,{label:"原文地址",prop:"originalUrl"},{default:p(()=>[n(r,{modelValue:le.originalUrl,"onUpdate:modelValue":l[8]||(l[8]=e=>le.originalUrl=e),placeholder:"请输入原文链接地址",clearable:""},{prefix:p(()=>[n(L,null,{default:p(()=>[n(m(E))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(x,{title:"摘要信息",icon:m(y)},null,8,["icon"]),n(u,{label:"摘要",prop:"abstract",class:"content-form-item"},{default:p(()=>[n(A,{type:"border-card",class:"simple-tabs"},{default:p(()=>[n(M,{label:"中文内容"},{default:p(()=>[s("div",I,[n(U,{modelValue:le.abstract,"onUpdate:modelValue":l[9]||(l[9]=e=>le.abstract=e),placeholder:"请输入中文摘要",height:350,disabled:"view"===X.value,simpleMode:!0},null,8,["modelValue","disabled"])])]),_:1}),n(M,{label:"英文内容"},{default:p(()=>[s("div",F,[n(U,{modelValue:le.abstractEn,"onUpdate:modelValue":l[10]||(l[10]=e=>le.abstractEn=e),placeholder:"请输入英文摘要",height:350,disabled:"view"===X.value,simpleMode:!0},null,8,["modelValue","disabled"])])]),_:1})]),_:1})]),_:1}),n(x,{title:"论文内容",icon:m(j)},null,8,["icon"]),n(u,{label:"内容",prop:"content",class:"content-form-item"},{default:p(()=>[n(A,{type:"border-card",class:"simple-tabs"},{default:p(()=>[n(M,{label:"中文内容"},{default:p(()=>[s("div",R,[n(U,{modelValue:le.content,"onUpdate:modelValue":l[11]||(l[11]=e=>le.content=e),placeholder:"请输入论文内容（中文）",height:500,disabled:"view"===X.value},null,8,["modelValue","disabled"])])]),_:1}),n(M,{label:"英文内容"},{default:p(()=>[s("div",B,[n(U,{modelValue:le.contentEn,"onUpdate:modelValue":l[12]||(l[12]=e=>le.contentEn=e),placeholder:"请输入论文内容（英文）",height:500,disabled:"view"===X.value},null,8,["modelValue","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","disabled"])])])])}}}),[["__scopeId","data-v-a4d70cf9"]]);export{A as default};
