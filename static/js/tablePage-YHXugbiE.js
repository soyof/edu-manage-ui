import{y as e,c as a,r as t,j as l,h as o,z as r,R as s,al as u,A as n,Y as p,X as i,n as g,aX as c,K as d,ar as v,L as f,B as h,a4 as m,J as y,C as _,F as b,ak as z,u as S,W as k,O as R}from"./vue-BMnUnhjY.js";import{_ as w}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{_ as F}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";const x={class:"pagination-container"},B=w(e({__name:"pagination",props:{pager:{},pageSizes:{default:()=>[10,20,50,100]},props:{default:()=>({page:"pageNo",size:"pageSize",total:"total"})},background:{type:Boolean,default:!0},layout:{default:"total, ->, prev, pager, next, jumper, sizes"}},emits:["update:pager","change"],setup(e,{emit:p}){const i=e,g=p,c=a(()=>i.pageSizes),d=a(()=>i.background),v=a(()=>i.layout),f=()=>i.props.page,h=()=>i.props.size,m=t(1),y=t(20);(()=>{const e=f(),a=h();m.value=i.pager[e]||1,y.value=i.pager[a]||i.pageSizes[0]})();const _=a({get:()=>m.value,set:e=>{m.value=e,k(e)}}),b=a({get:()=>y.value,set:e=>{y.value=e,F(e)}}),z=a(()=>{const e=i.props.total,a=i.pager[e];return"number"==typeof a?a:0}),S=e=>{const a={...i.pager,...e};g("update:pager",a)},k=e=>{const a=f();m.value=e,S({[a]:e}),setTimeout(()=>{g("change")},0)},R=e=>{k(e)},w=e=>{k(e)},F=e=>{const a=h(),t=f();y.value=e,m.value=1,S({[a]:e,[t]:1}),setTimeout(()=>{g("change")},0)};return l(()=>i.pager,e=>{const a=f(),t=h();"number"==typeof e[a]&&(m.value=e[a]),"number"==typeof e[t]&&(y.value=e[t])},{deep:!0,immediate:!0}),o(()=>{const e=h();e in i.pager&&i.pageSizes.length>1&&(i.pageSizes.includes(i.pager[e])||S({[e]:i.pageSizes[0]}))}),(e,a)=>{const t=u("el-pagination");return n(),r("div",x,[s(t,{currentPage:_.value,"onUpdate:currentPage":a[0]||(a[0]=e=>_.value=e),pageSize:b.value,"onUpdate:pageSize":a[1]||(a[1]=e=>b.value=e),pageSizes:c.value,total:z.value,background:d.value,class:"self-pagination",layout:v.value,onSizechange:F,onCurrentchange:k,onPrevclick:R,onNextclick:w},null,8,["currentPage","pageSize","pageSizes","total","background","layout"])])}}}),[["__scopeId","data-v-76a1a33b"]]),N={ref:"tableRef",class:"table-page-content"},P=w(e({__name:"tablePage",props:{showSearch:{type:Boolean,default:!0},showOperation:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0},initialSearchForm:{type:Object,default:()=>({})},fetchData:{type:Function,required:!0},labelWidth:{type:String,default:"auto"},autoLoad:{type:Boolean,default:!0}},emits:["update:searchForm","search","reset"],setup(e,{expose:a,emit:l}){const w=e,x=l,P=t({pageNo:1,pageSize:20,total:0}),T=t({...w.initialSearchForm}),j=t([]),H=t(!1),L=c("pageRef"),C=c("headerRef"),W=c("operaRef"),$=c("pagerRef"),{tableHeight:O}=(e=>{const{pageRef:a,deductRefs:l,extraDeduct:r=12,minHeight:s=100,delay:u=200}=e,n=t(s);let c=null;const d=()=>a.value?g().then(()=>{try{const e=a.value?.clientHeight||0,t=l.reduce((e,a)=>e+(a.value?.clientHeight||0),0),o=Math.max(e-t-r,s);return n.value=o,o}catch(e){return n.value=s,s}}):n.value,v=()=>{c&&(clearTimeout(c),c=null),c=setTimeout(()=>{d()},u)};return o(()=>{setTimeout(()=>{d(),window.addEventListener("resize",v)},u)}),p(()=>{d()}),i(()=>{window.removeEventListener("resize",v),c&&(clearTimeout(c),c=null)}),{tableHeight:n,recalculateHeight:()=>d()}})({pageRef:L,deductRefs:[C,W,$]}),D=()=>{T.value={...w.initialSearchForm},x("reset",T.value)},I=()=>{x("search",T.value),K()},K=e=>{H.value||(H.value=!0,P.value.pageNo=e||P.value.pageNo,w.fetchData({pageNo:P.value.pageNo,pageSize:P.value.pageSize,...T.value}).then(e=>{P.value={...P.value,total:e.total||0},j.value=e.list||[]}).finally(()=>{H.value=!1}))};return a({getList:K,resetForm:D,searchForm:T}),o(()=>{w.autoLoad&&K()}),(a,t)=>{const l=u("el-form-item"),o=u("el-col"),p=u("el-row"),i=u("el-form"),g=u("el-table"),c=v("loading");return d((n(),r("div",{ref_key:"pageRef",ref:L,class:"table-page"},[e.showSearch?(n(),r("div",{key:0,ref_key:"headerRef",ref:C,class:"table-page-header"},[s(i,{ref:"ruleFormRef",model:T.value,statusIcon:"",labelWidth:e.labelWidth,size:"default",inline:"",onKeyup:m(I,["enter"])},{default:y(()=>[s(p,{gutter:24},{default:y(()=>[_(a.$slots,"search-form",{form:T.value},void 0,!0),s(o,{span:6},{default:y(()=>[s(l,null,{default:y(()=>[s(F,{type:"primary",onClick:k(I,["prevent"])},{default:y(()=>[...t[1]||(t[1]=[R(" 查询 ",-1)])]),_:1}),s(F,{onClick:k(D,["prevent"])},{default:y(()=>[...t[2]||(t[2]=[R("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:3})]),_:3},8,["model","labelWidth"])],512)):f("",!0),e.showOperation?(n(),r("div",{key:1,ref_key:"operaRef",ref:W,class:"table-page-opera"},[_(a.$slots,"operation",{},void 0,!0)],512)):f("",!0),h("div",N,[s(g,b({data:j.value,border:"",height:S(O)},a.$attrs,z(a.$attrs)),{default:y(()=>[_(a.$slots,"default",{},void 0,!0)]),_:3},16,["data","height"])],512),e.showPagination?(n(),r("div",{key:2,ref_key:"pagerRef",ref:$,class:"table-page-pager"},[s(B,{pager:P.value,"onUpdate:pager":t[0]||(t[0]=e=>P.value=e),onChange:K},null,8,["pager"])],512)):f("",!0)])),[[c,H.value]])}}}),[["__scopeId","data-v-0b3c87fb"]]);export{P as T};
