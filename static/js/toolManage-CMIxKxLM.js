import{y as e,r as l,c as t,z as a,R as o,J as s,I as i,L as u,u as n,al as p,B as r,P as d,O as c,E as h,M as m,Q as f,a6 as b,aD as w,A as _}from"./vue-BMnUnhjY.js";import{u as v,s as T}from"./index-BT6KgQx3.js";import{e as y,w as g,S,a3 as V,a4 as k,E as U,C}from"./elementPlus-iRxZk2_b.js";import{_ as I}from"./throttleButton.vue_vue_type_script_setup_true_lang-D3gBfjRi.js";import{T as O}from"./tablePage-YHXugbiE.js";import{c as A}from"./statusConfig-Cju3zQbK.js";import{u as x}from"./useDictionary-Cg9QFWfd.js";import{_ as j}from"./_plugin-vue_export-helper-BCo6x5W8.js";const R={class:"tool-manage-container common-action-column"},D=["title","onClick"],B={class:"action-column-container"},P=["onClick"],L=["onClick"],N=["onClick"],$=j(e({__name:"toolManage",setup(e){const j=A("待发布","已发布","已下线"),$=x({dictType:"opensource_tool_type",autoLoad:!0}),M=w(),Y=v().isAdmin,q={title:"",toolType:"",publishStatus:"",publishUserId:"",publishTimesRange:[]},z=l(null),E=l([]),F=t(()=>0===E.value.length||E.value.some(e=>"1"===e.publishStatus)),H=e=>T.post("/api/tool/list",e),J=e=>{E.value=e},K=()=>{M.push({path:"/modifyToolInfos",query:{mode:"add",tabTitle:encodeURIComponent("新增工具")}})},Q=e=>{z.value?.getList(e)},W=e=>{const l=!e;if(l&&0===E.value.length)return void U.warning("请选择要删除的工具");if(l&&E.value.some(e=>"1"===e.publishStatus))return void U.warning("已发布的工具不能删除");if(!l&&"1"===e?.publishStatus)return void U.warning("已发布的工具不能删除");const t=l?E.value.map(e=>e.id):e.id,a=l?`确认删除选中的 ${E.value.length} 条工具信息吗？`:"确认删除该工具信息吗？";C.confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T.post("/api/tool/delete",{ids:t}).then(()=>{U.success("删除成功"),Q(1)})}).catch(()=>{})};return(e,l)=>{const t=p("el-input"),w=p("el-form-item"),v=p("el-col"),A=p("el-option"),x=p("el-select"),E=p("el-date-picker"),G=p("el-icon"),X=p("el-tooltip"),Z=p("el-table-column"),ee=p("el-tag");return _(),a("div",R,[o(O,{ref_key:"tablePageRef",ref:z,fetchData:H,initialSearchForm:q,onSelectionChange:J},{"search-form":s(({form:e})=>[o(v,{span:6},{default:s(()=>[o(w,{label:"工具标题"},{default:s(()=>[o(t,{modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,placeholder:"请输入工具标题",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(v,{span:6},{default:s(()=>[o(w,{label:"工具类型"},{default:s(()=>[o(x,{modelValue:e.toolType,"onUpdate:modelValue":l=>e.toolType=l,placeholder:"请选择工具类型",clearable:""},{default:s(()=>[(_(!0),a(f,null,b(n($).dictList.value,e=>(_(),i(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),n(Y)?(_(),i(v,{key:0,span:6},{default:s(()=>[o(w,{label:"发布状态"},{default:s(()=>[o(x,{modelValue:e.publishStatus,"onUpdate:modelValue":l=>e.publishStatus=l,placeholder:"请选择发布状态",clearable:""},{default:s(()=>[(_(!0),a(f,null,b(n(j).list,e=>(_(),i(A,{key:e.dictId,label:e.dictValue,value:e.dictId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):u("",!0),n(Y)?(_(),i(v,{key:1,span:6},{default:s(()=>[o(w,{label:"发布人"},{default:s(()=>[o(t,{modelValue:e.publishUserId,"onUpdate:modelValue":l=>e.publishUserId=l,placeholder:"请输入发布人",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):u("",!0),o(v,{span:6},{default:s(()=>[o(w,{label:"发布时间"},{default:s(()=>[o(E,{modelValue:e.publishTimesRange,"onUpdate:modelValue":l=>e.publishTimesRange=l,type:"daterange",rangeSeparator:"~",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),operation:s(()=>[n(Y)?(_(),a(f,{key:0},[o(X,{content:"新增工具",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(I,{size:"small",type:"primary",onClick:K},{default:s(()=>[o(G,null,{default:s(()=>[o(n(k))]),_:1})]),_:1})]),_:1}),o(X,{content:"批量删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[o(I,{size:"small",type:"danger",disabled:F.value,onClick:l[0]||(l[0]=e=>W())},{default:s(()=>[o(G,null,{default:s(()=>[o(n(V))]),_:1})]),_:1},8,["disabled"])]),_:1})],64)):u("",!0)]),default:s(()=>[n(Y)?(_(),i(Z,{key:0,type:"selection",width:"50",fixed:"left"})):u("",!0),o(Z,{prop:"title",label:"工具标题(中文)",minWidth:"180",showOverflowTooltip:""},{default:s(e=>[r("span",{class:"clickable-title",title:e.row.title,onClick:l=>(e=>{const l=`工具详情【${e.title}】`;M.push({path:"/toolDetail",query:{mode:"view",id:String(e.id),tabTitle:encodeURIComponent(l)}})})(e.row)},d(e.row.title),9,D)]),_:1}),o(Z,{prop:"titleEn",label:"工具标题(英文)",width:"180",showOverflowTooltip:""}),o(Z,{prop:"toolType",label:"工具类型",width:"120",showOverflowTooltip:""},{default:s(e=>[c(d(n($).getDictLabel(e.row.toolType)),1)]),_:1}),o(Z,{prop:"toolUrl",label:"工具地址",width:"200",showOverflowTooltip:""}),o(Z,{prop:"publishStatus",label:"发布状态",width:"100",showOverflowTooltip:""},{default:s(e=>[o(ee,{type:n(j).getTagType(e.row.publishStatus)},{default:s(()=>[c(d(n(j).getName(e.row.publishStatus)),1)]),_:2},1032,["type"])]),_:1}),o(Z,{prop:"publishUserName",label:"发布人",width:"120",showOverflowTooltip:""}),o(Z,{prop:"publishTimes",label:"发布时间",width:"180",showOverflowTooltip:""}),o(Z,{prop:"updateUserName",label:"更新人",width:"120",showOverflowTooltip:""}),o(Z,{prop:"updatedTimes",label:"更新时间",width:"180",showOverflowTooltip:""}),o(Z,{prop:"createUserName",label:"创建人",width:"120",showOverflowTooltip:""}),o(Z,{prop:"createdTimes",label:"创建时间",width:"180",showOverflowTooltip:""}),n(Y)?(_(),i(Z,{key:1,fixed:"right",label:"操作",width:"110",className:"action-column"},{default:s(e=>[r("div",B,[o(X,{content:"1"===e.row.publishStatus?"已发布工具不能编辑":"编辑",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[r("span",{class:h(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:l=>"1"!==e.row.publishStatus&&(e=>{const l=`编辑工具【${e.title}】`;M.push({path:"/modifyToolInfos",query:{mode:"edit",id:String(e.id),tabTitle:encodeURIComponent(l)}})})(e.row)},[o(G,{class:"action-icon edit-icon"},{default:s(()=>[o(n(y))]),_:1})],10,P)]),_:2},1032,["content"]),o(X,{content:"0"===e.row.publishStatus?"发布":"1"===e.row.publishStatus?"下线":"上线",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[r("span",{class:"action-icon-wrapper",onClick:l=>((e,l)=>{const t="publish"===l,a=t?"发布":"下线";C.confirm(`确认${a}该工具吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:t?"info":"warning"}).then(()=>{T.post("/api/tool/publish",{id:e.id,action:l}).then(()=>{U.success(`${a}成功`),Q(1)})}).catch(()=>{})})(e.row,"1"===e.row.publishStatus?"unpublish":"publish")},[o(G,{class:h(["action-icon",{"publish-icon":"0"===e.row.publishStatus||"2"===e.row.publishStatus,"unpublish-icon":"1"===e.row.publishStatus}])},{default:s(()=>[(_(),i(m("1"===e.row.publishStatus?n(g):n(S))))]),_:2},1032,["class"])],8,L)]),_:2},1032,["content"]),o(X,{content:"1"===e.row.publishStatus?"已发布工具不能删除":"删除",placement:"top",showAfter:200,hideAfter:0},{default:s(()=>[r("span",{class:h(["action-icon-wrapper",{"disabled-wrapper":"1"===e.row.publishStatus}]),onClick:l=>"1"!==e.row.publishStatus&&W(e.row)},[o(G,{class:"action-icon delete-icon"},{default:s(()=>[o(n(V))]),_:1})],10,N)]),_:2},1032,["content"])])]),_:1})):u("",!0)]),_:1},512)])}}}),[["__scopeId","data-v-16983fe4"]]);export{$ as default};
